= FHIR VZD implementation guide
:source-highlighter: rouge
:icons:
:title-page:
:imagesdir: /images/
ifdef::env-github[]
:toc: preamble
endif::[]
ifndef::env-github[]
:toc: left
endif::[]
:toclevels: 3
:toc-title: Table of Contents
:sectnums:


image::gematik_logo.svg[gematik,float="right"]

[width="100%",cols="50%,50%",options="header",]
|===
|Version: |0.0.1
|Referencing: |gemILF_FHIR_VZD
|===

[big]*Document history*

[width="100%",cols="11%,11%,7%,58%,13%",options="header",]
|===
|*Version* +
 |*Stand* +
 |*Chap./ Page* +
 |*Change reason, special instructions* +
 |*Editing* +

|1.0.0 |04.04.23 | |Initial document |gematik

|===

== Classification of the document
=== Objective
This document describes how the interfaces of the FHIR directory service can be implemented and used on the client side.

=== Target group

The document is aimed at software developers who are involved in implementing a client of the FHIR directory service.

=== Scope

*Intellectual property/patent notice*

_The following specification was created by gematik solely from a technical point of view. In individual cases, it cannot be ruled out that the implementation of the specification will interfere with the technical property rights of third parties. It is solely up to the supplier or manufacturer to take suitable measures to ensure that the products and/or services offered by him on the basis of the specification do not infringe third-party property rights and, if necessary, to obtain the necessary permits/licenses from the property right holders concerned. In this respect, gematik GmbH assumes no liability whatsoever._


== API Documentation
=== FHIRDirectorySearchAPI: Search for Practitioners and Organizations
==== Authentication
To use the search operation, a corresponding access token from the FHIRDirectoryAuthorizationService must be available. +
 +
With the following procedure an access token can be obtained:
 
*Get  authentication methods supported by the Matrix homeserver*
[source]
----
 curl -X GET "[Matrix homeserver url]/_matrix/client/r0/login"
----
This operation returns the supported authentication methods. For example:
[source]
----
200
{
  "flows": [
    {
      "type": "m.login.password"
    },
    {
      "type": "m.login.application_service"
    },
    {
      "type": "uk.half-shot.msc2778.login.application_service"
    }
  ]
}
----

*Perform login and get Matrix Access Token*
The login operation depends from the selected authentication methods which can be dependent from the used environment.

[source]
----
curl -X POST "[Matrix homeserver url]/_matrix/client/r0/login" \
    -H "Content-Type: application/json" \
    -d @- << EOF
{
  "type": "m.login.password",
  "user": "username",
  "password": "password of the user"
}
EOF
----
This operation returns a matrix access_token. For example:
[source]
----
200
{
  "user_id": "username",
  "access_token": "syt_ZXR0cjAy_JVJehocKZFlYyRbtTdiz_18uj52",
  "home_server": "matix.home.server.de",
  "device_id": "ABCDEFGHIJ"
}
----

*Request Matrix OpenID Token*
[source]
----
curl -X POST "[Matrix homeserver url]/_matrix/client/v3/user/username/openid/request_token?access_token=syt_ZXR0cjAy_JVJehocKZFlYyRbtTdiz_18uj52" \
    -H "Content-Type: application/json" \
    -d @- << EOF
{}
EOF
----
In this operation the "username" has to be replaced by the username used in the operations above. +
For the access_token parameter the access_token returen in the last operation has to be used as value. +
 +
This operation returns a matrix access_token. For example:
[source]
----
200
{
  "access_token": "zbKsYFDoZBWcKJMylLjCcMcR",
  "token_type": "Bearer",
  "matrix_server_name": "matix.home.server.de",
  "expires_in": 3600
}
----

*Get the access token from the FHIR-Directory*
[source]
----
curl -X GET "[FHIRbaseUrl]/tim-authenticate?mxId=matrix.dev.service-ti.de" \
    -H "X-Matrix-OpenID-Token: zbKsYFDoZBWcKJMylLjCcMcR"
----
For the X-Matrix-OpenID-Token parameter the access_token returen in the last operation has to be used as value. +
 +
This operation returns a access token from the FHIR-Directory. For example:
[source]
----
200
{
  "jwt":
"eyJ0eXAiOiJKV1QiLCJhbGciOiJFUzI1NiJ9.e2lzcyI6Imh0dHBzOi8vZmhpci1kaXJlY3RvcnktdGVzdC52emQudGktZGllbnN0ZS5kZS90aW0tYXV0aGVudGljYXRlIiwiYXVkIjoiaHR0cHM6Ly9maGlyLWRpcmVjdG9yeS10ZXN0LnZ6ZC50aS1kaWVuc3RlLmRlL3NlYWNoIiwic3ViIjoiQGFiY2RlOm1hdHJpeC5kZXYuc2VydmljZS10aS5kZSIsImlhdCI6MTY2NDEyMjY3MywiZXhwIjoxNjY0MjA5MDczfQ.CoTwrZmZJyfVYVJFD068QJNFo0YLemhfPVER_lW5h3MU2hgoiSj1lkD6yDHPDQAs4JJ6PlBWIUHtoGoYAwVOVw",
  "token_type": "bearer",
  "expires_in": 86400
}
----
Please note, that this example access token has an invalid signature (sub claim anonymized). +
 +
The access token is a JWT with the following structure:
----
Header:
{
  "typ": "JWT",
  "alg": "ES256"
}

Payload:

{
 "iss": "https://fhir-directory-test.vzd.ti-dienste.de/tim-authenticate\",
 "aud": "https://fhir-directory-test.vzd.ti-dienste.de/seach",
 "sub": "@abcde:matrix.dev.service-ti.de",
 "iat": 1664122673,
 "exp": 1664209073
 }

Signature:
...
----


*Perform a FHIR-Search*
[source]
----
curl -X GET "https://fhir-directory-test.vzd.ti-dienste.de/search/HealthcareService?organization.active=true&_count=1" \
    -H "Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJFUzI1NiJ9.e2lzcyI6Imh0dHBzOi8vZmhpci1kaXJlY3RvcnktdGVzdC52emQudGktZGllbnN0ZS5kZS90aW0tYXV0aGVudGljYXRlIiwiYXVkIjoiaHR0cHM6Ly9maGlyLWRpcmVjdG9yeS10ZXN0LnZ6ZC50aS1kaWVuc3RlLmRlL3NlYWNoIiwic3ViIjoiQGFiY2RlOm1hdHJpeC5kZXYuc2VydmljZS10aS5kZSIsImlhdCI6MTY2NDEyMjY3MywiZXhwIjoxNjY0MjA5MDczfQ.CoTwrZmZJyfVYVJFD068QJNFo0YLemhfPVER_lW5h3MU2hgoiSj1lkD6yDHPDQAs4JJ6PlBWIUHtoGoYAwVOVw
----
For the "Authorization" parameter the access_token returend from the FHIR-Directory in the last operation has to be used as value. +
 +

==== FHIR Search Basics
The REST interface /search allows you to search for practitioners and organizations. 
The standard FHIR search operation is used https://build.fhir.org/search.html +

GET [baseUrl]/[resourceType]?[optional parameters] +
 +
As resourceType are supported

- HealthcareService (search for organizations)
- PractitionerRole (search for practitioners)

The overview about the supported data model can be found here: 
https://simplifier.net/vzd-fhir-directory

Only resources with the status "active" may be displayed. For this reason, the [resource].active=true parameter must be specified for all search operations. The minimal variant of the search operations thus looks like this:

- GET [baseUrl]/search/HealthcareService?organization.active=true
- GET [baseUrl]/search/PractitionerRole?practitioner.active=true

As result, the client receives a FHIR http://hl7.org/fhir/bundle.html[Bundle] resource with the search result. +
 +
 +
In addition to the HL7 FHIR specification, the FHIR VZD supports the following search parameters 

- practitioner.qualification
- location.address (e.g. to search for TI-Messenger addresses)

The following HL7 FHIR search parameters are not yet support (but are in work):

- https://hl7.org/fhir/search.html#_text[_text]
- https://hl7.org/fhir/search.html#_content[_content]

==== FHIR Search Organizations

To search for organizations, use "HealthcareService" as the resource type and at least "organization.active=true" as the parameter:
[source]
--
GET [baseUrl]/search/HealthcareService?organization.active=true
--
Additional parameters can be added to refine the search. +
 +

==== FHIR Search Practitioners
To search for people, use "PractitionerRole" as the resource type and at least "practitioner.active=true" as the parameter:
[source]
--
GET [baseUrl]/search/PractitionerRole?practitioner.active=true
--
Additional parameters can be added to refine the search.
 +
 
==== FHIR Search Parameters - Overview
FHIR defines which search parameters can be used for each resource. 
For each resource the is a "Search Parameters" section. Examples: +

- For practitioners https://www.hl7.org/fhir/practitioner.html#search
- For organizations https://www.hl7.org/fhir/organization.html#search
- For endpoints https://www.hl7.org/fhir/endpoint.html#search
- For locations https://www.hl7.org/fhir/location.html#search

An overview about all resources with its search parameters can be found here: 
https://www.hl7.org/fhir/searchparameter-registry.html +
 +
The behavior of the search parameter depends from the parameter type and is documented here: https://www.hl7.org/fhir/search.html#ptypes +
 +

==== FHIR Search Parameters - Custom Search Parameters
The following custom search parameters are supported in addition to the standard FHIR search parameters

- Endpoint.address
- Practitioner.qualification
** Practitioner.qualification.code.coding.code  
** Practitioner.qualification.code.coding.display


 
==== FHIR VZD Search - "practitioner.name" attribute
To search a resource the "name" attribute of it can be used in the search operation:
[source]
--
GET [baseUrl]/search/search/PractitionerRole?practitioner.active=true&practitioner.name=Timjamin
--


.Table Used search parameters
|===
|FHIR search parameter |Parameter Value | Explanation

|practitioner.name
|Timjamin
|The string "Timjamin" is searched for attribute "name" of the "practitioner" resource.   

|===
 
 
Response of this Request: 
link:../samples/FHIRseach/Search_PractitionerRole_name.adoc[Search_PractitionerRole_name] +
 +
 
==== FHIR VZD Search - "endpoint.payload-type" attribute (code based search)
To search a resource which supports a defined type of communication the "endpoint.payload-type" attribute can be used in the search operation:
[source]
--
GET [baseUrl]/search/PractitionerRole?practitioner.active=true&_include=PractitionerRole:practitioner&_include=PractitionerRole:location&_include=PractitionerRole:endpoint&endpoint.payload-type=tim-chat&endpoint.status=active
--


.Table Used search parameters
|===
|FHIR search parameter |Parameter Value | Explanation

|endpoint.payload-type
|tim-chat
|The link:https://hl7.org/fhir/endpoint.html#search["payload-type"] is used to searched for resources, supporting the TI-Messenger chat communication. 
 The definition of the link:https://hl7.org/fhir/endpoint.html["endpoint"] is refined in simplifier for the link:https://simplifier.net/vzd-fhir-directory/["FHIR VZD"]. For the payloadType the link:https://simplifier.net/vzd-fhir-directory/endpointpayloadtypevs["ValueSet EndpointPayloadTypeVS"] imports all values from link:https://simplifier.net/vzd-fhir-directory/endpointdirectorypayloadtype["EndpointDirectoryPayloadType"].

|_include
|PractitionerRole:practitioner
|"practitioner" resources, linked to the "PractitionerRole" resources of the search request are included in the search response.   

|_include
|PractitionerRole:location
|"location" resources, linked to the "PractitionerRole" resources of the search request are included in the search response.   

|_include
|PractitionerRole:endpoint
|"endpoint" resources, linked to the "PractitionerRole" resources of the search request are included in the search response.   

|endpoint.status
|active
|The search parameter link:https://hl7.org/fhir/endpoint.html#search["status"] ensures, that only active endpoints are returned. 
If endpoints are needed, then only active endpoints have to be used/displayed. This has to be ensured by all clients.
Please note that with this parameter resources with no active endpoints are not returned.

|===
 
 
Response of this Request: 
link:../samples/FHIRseach/Search_PractitionerRole_payload-type.adoc[Search_PractitionerRole_payload-type] +
 +

 
==== FHIR VZD Search - "endpoint.payload-type" attribute (display text based search)
For the display text of a coded attribute can be searched with the modifier link:https://hl7.org/fhir/search.html#modifiers[":text"]:

[source]
--
GET [baseUrl]/search/PractitionerRole?practitioner.active=true&_include=PractitionerRole:practitioner&_include=PractitionerRole:location&_include=PractitionerRole:endpoint&endpoint.payload-type:text=TI-Messenger chat&endpoint.status=active
--


.Table Used search parameters
|===
|FHIR search parameter |Parameter Value | Explanation

|endpoint.payload-type:text
|TI-Messenger chat
|The link:https://hl7.org/fhir/endpoint.html#search["payload-type"] is used to searched for resources, supporting the TI-Messenger chat communication. 
 The definition of the link:https://hl7.org/fhir/endpoint.html["endpoint"] is refined in simplifier for the link:https://simplifier.net/vzd-fhir-directory/["FHIR VZD"]. For the payloadType the link:https://simplifier.net/vzd-fhir-directory/endpointpayloadtypevs["ValueSet EndpointPayloadTypeVS"] imports all values from link:https://simplifier.net/vzd-fhir-directory/endpointdirectorypayloadtype["EndpointDirectoryPayloadType"].

|_include
|PractitionerRole:practitioner
|"practitioner" resources, linked to the "PractitionerRole" resources of the search request are included in the search response.   

|_include
|PractitionerRole:location
|"location" resources, linked to the "PractitionerRole" resources of the search request are included in the search response.   

|_include
|PractitionerRole:endpoint
|"endpoint" resources, linked to the "PractitionerRole" resources of the search request are included in the search response.   

|endpoint.status
|active
|The search parameter link:https://hl7.org/fhir/endpoint.html#search["status"] ensures, that only active endpoints are returned. 
If endpoints are needed, then only active endpoints have to be used/displayed. This has to be ensured by all clients.
Please note that with this parameter resources with no active endpoints are not returned.

|===
 
 
Response of this Request: 
link:../samples/FHIRseach/Search_PractitionerRole_payload-type_text.adoc[Search_PractitionerRole_payload-type:text] +
 +
 
==== FHIR VZD Search - complex search request
Search in a city for a practitioner with a defined qualification and offers the communication via TI-Messenger:

[source]
--
GET [baseUrl]/search/PractitionerRole?practitioner.active=true&_include=PractitionerRole:practitioner&_include=PractitionerRole:location&_include=PractitionerRole:endpoint&location.address-city=Gelsenkirchen&location.address=45884&practitioner.qualification=1.2.276.0.76.4.241&endpoint.payload-type=tim-chat&endpoint.status=active
--


.Table Used search parameters
|===
|FHIR search parameter |Parameter Value | Explanation

|_include
|PractitionerRole:practitioner
|"practitioner" resources, linked to the "PractitionerRole" resources of the search request are included in the search response.   

|_include
|PractitionerRole:location
|"location" resources, linked to the "PractitionerRole" resources of the search request are included in the search response.   

|_include
|PractitionerRole:endpoint
|"endpoint" resources, linked to the "PractitionerRole" resources of the search request are included in the search response.   

|location.address-city
|Gelsenkirchen
|Search for practitioners with search parameter link:https://www.hl7.org/fhir/location.html#search["address-city"] in the city "Gelsenkirchen". "address-city" limits the search to the address attribute "city", search parameter "address" searches all address attributes for the string.

|location.address
|45884
|Search for practitioners with search parameter link:https://www.hl7.org/fhir/location.html#search["address"] in all address attributes for "45884". 

|practitioner.qualification
|1.2.276.0.76.4.241
|Search for practitioners with search parameter "qualification" for qualification code "1.2.276.0.76.4.241". +
Note: For humans a readable text should be used for selection and display of coded attributes.

|endpoint.payload-type
|tim-chat
|The link:https://hl7.org/fhir/endpoint.html#search["payload-type"] is used to searched for resources, supporting the TI-Messenger chat communication. 
 The definition of the link:https://hl7.org/fhir/endpoint.html["endpoint"] is refined in simplifier for the link:https://simplifier.net/vzd-fhir-directory/["FHIR VZD"]. For the payloadType the link:https://simplifier.net/vzd-fhir-directory/endpointpayloadtypevs["ValueSet EndpointPayloadTypeVS"] imports all values from link:https://simplifier.net/vzd-fhir-directory/endpointdirectorypayloadtype["EndpointDirectoryPayloadType"].

|endpoint.status
|active
|The search parameter link:https://hl7.org/fhir/endpoint.html#search["status"] ensures, that only active endpoints are returned. 
If endpoints are needed, then only active endpoints have to be used/displayed. This has to be ensured by all clients.
Please note that with this parameter resources with no active endpoints are not returned.

|===
 
 
Response of this Request: 
link:../samples/FHIRseach/Search_PractitionerRole_complex.adoc[Search_PractitionerRole_complex] +
 +
 
==== FHIR VZD Search - HealtcareService by telematikID
Search an organization with a telematikID:

[source]
--
GET [baseUrl]/search/HealthcareService?organization.active=true&_include=*&endpoint.status=active&organization.identifier=1-2arvtst-ap000052
--


.Table Used search parameters
|===
|FHIR search parameter |Parameter Value | Explanation

|_include
*
|All resources, linked to the "HealthcareService" resources of the search request are included in the search response.   

|endpoint.status
|active
|The search parameter link:https://hl7.org/fhir/endpoint.html#search["status"] ensures, that only active endpoints are returned. 
If endpoints are needed, then only active endpoints have to be used/displayed. This has to be ensured by all clients.
Please note that with this parameter resources with no active endpoints are not returned.

|organization.identifier
|1-2arvtst-ap000052
|Search for the organization with search parameter "identifier" for telematikID "1-2arvtst-ap000052". +
Note: A resourcew may contain several values in the "identifier". This request searches in all identifier values, independent from the identifier coding system.

|===
 
Response of this Request: 
link:../samples/FHIRseach/Search_HealthcareService_telematikID.adoc[Search_HealthcareService_telematikID] +
 +
 

==== FHIR VZD Search results
The Client can manage the content of the FHIR search response with several parameters. In this section some examples are shown. The full list of parameters for managing search results can be found here: https://www.hl7.org/fhir/search.html#return +
 +
 
===== _include Parameter + 
The response of the 'FHIR VZD Search with "name" attribute' contains only resources of type "PractitionerRole". +
With the link:https://www.hl7.org/fhir/search.html#revinclude["_include"] parameter also resources linked with the search result resources are returned: +
 +
 
[source]
--
GET [baseUrl]/search/PractitionerRole?practitioner.active=true&practitioner.name=Timjamin&_include=PractitionerRole:practitioner&_include=PractitionerRole:location&_include=PractitionerRole:endpoint&endpoint.status=active
--


.Table Used search parameters
|===
|FHIR search parameter |Parameter Value | Explanation

|practitioner.name
|Timjamin
|The string "Timjamin" is searched for attribute "name" of the "practitioner" resource.   

|_include
|PractitionerRole:practitioner
|"practitioner" resources, linked to the "PractitionerRole" resources of the search request are included in the search response.   

|_include
|PractitionerRole:location
|"location" resources, linked to the "PractitionerRole" resources of the search request are included in the search response.   

|_include
|PractitionerRole:endpoint
|"endpoint" resources, linked to the "PractitionerRole" resources of the search request are included in the search response.   

|endpoint.status
|active
|The search parameter link:https://hl7.org/fhir/endpoint.html#search["status"] ensures, that only active endpoints are returned. 
If endpoints are needed, then only active endpoints have to be used/displayed. This has to be ensured by all clients.
Please note that with this parameter resources with no active endpoints are not returned.

|===
 
 
Response of this Request: 
link:../samples/FHIRseach/Search_PractitionerRole_name_include.adoc[Search_PractitionerRole_name_include]
 +
 +

===== _summary Parameter - count the results +  
Using the parameter link:https://www.hl7.org/fhir/search.html#summary[_summary] the client can request the server to return only a portion of the resources:
[source]
--
GET [baseUrl]/search/PractitionerRole?practitioner.active=true&_summary=count
--


.Table Used search parameters
|===
|FHIR search parameter |Parameter Value | Explanation

|_summary
|count
|only the number of the matching resources is returned   

|===
 
 
Response of this Request: 
link:../samples/FHIRseach/Search_Result_count.adoc[Search_Result_count]
 +


=== FHIRDirectoryTIMProviderAPI: Administration of TI-Provider data
==== Client credentials grant flow
To use the API operations, a corresponding TI-Provider API Token from the FHIRDirectoryAuthorizationService must be available. +
 +
With the following operation an access token can be obtained:
 

[source]
----
 curl -X POST "[baseUrl]:9443/auth/realms/TI-Provider/protocol/openid-connect/token" \
      -H "Content-Type: application/x-www-form-urlencoded" \
      -H "Authorization: Basic VElNUHJvdmlkZXI6YjEyMzMxZTktYWJjZC00NTY3LTZhaWUtZGY4ZTY4Y2E0ZmZj=" \
      -d @- << EOF
grant_type=client_credentials
EOF
----
The Authorization string contains the base64 encoded client credentials. +
 +
This operation returns an access token. For example:
[source]
----
{
 "access_token": "eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJiMkJXT0w2dmN2QjluMjhnYVRwQ19fQllnXzI1aDljMkN2UGVXbmFGYUVNIn0.eyJqdGkiOiI5YjFkYjQ2ZC0yOThmLTQ0ZGItOTQ3ZC0wODdmYTNkYjQ2YzMiLCJleHAiOjE2Nzg4NjcwMjQsIm5iZiI6MCwiaWF0IjoxNjc4ODY2NzI0LCJpc3MiOiJodHRwOi8vYXV0aC10ZXN0LnZ6ZC50aS1kaWVuc3RlLmRlOjk0NDMvYXV0aC9yZWFsbXMvVEktUHJvdmlkZXIiLCJzdWIiOiI2MWJjODJiOC0yN2VlLTRkMDUtYTc0OC1iNmQ3Zjc4NDk4ZmIiLCJ0eXAiOiJCZWFyZXIiLCJhenAiOiJnZW1hdGlrIiwiYXV0aF90aW1lIjowLCJzZXNzaW9uX3N0YXRlIjoiMjg4NTc4MDgtNWIyNS00NWJhLWIzMDEtOGVkYjQzNTA4Mzc4IiwiYWNyIjoiMSIsInNjb3BlIjoidGktcHJvdmlkZXIiLCJjbGllbnRJZCI6ImdlbWF0aWsiLCJjbGllbnRIb3N0IjoiMTcyLjI0LjQ2LjEwIiwiY2xpZW50QWRkcmVzcyI6IjE3Mi4yNC40Ni4xMCJ9.LUbOr4XlICADdYuyT_SgviTBdXkSKdXQ43Fnp9VF7lr71Zrf0ELWiXkr1SplrMUmJrrbff8SaEzZTyy9Fx32xFTJnkX_Dw3uugbWXcARC-895lotzJ1Je4CJZSNSUSv4m6e86M8L7dfXjXxrbPAh4hH8IFWpudgF0mPG12VQMhaupJu13o2gIzB1GL7dk567_RVWXML8hi4ib6DT5dgZjIHFKKSAeuw99Xq0m1XdkwPCL9t8aIemY9lShQ2obvj70C8jBaIjquNGAScIrn3oTTLXs54XBN-t839M5wU0fxpwwHhuaDpRF-uLmPdQA3zE7MCNJYXkzl9nWdh2dLD31w",
  "expires_in":300,
  "refresh_expires_in":1800,
  "refresh_token":
 "eyJhbGciOiJIUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICIwMjk2NzMzNC1hOGJhLTQyNWYtYWQyOC1jYzAyOWE4YThhZDAifQ.eyJqdGkiOiIxMGY4ZjAyNi1iMzA1LTRjYmMtOWU4Yi1hZWE5MWY0YTRiMTciLCJleHAiOjE2Nzg4Njg1MjQsIm5iZiI6MCwiaWF0IjoxNjc4ODY2NzI0LCJpc3MiOiJodHRwOi8vYXV0aC10ZXN0LnZ6ZC50aS1kaWVuc3RlLmRlOjk0NDMvYXV0aC9yZWFsbXMvVEktUHJvdmlkZXIiLCJhdWQiOiJodHRwOi8vYXV0aC10ZXN0LnZ6ZC50aS1kaWVuc3RlLmRlOjk0NDMvYXV0aC9yZWFsbXMvVEktUHJvdmlkZXIiLCJzdWIiOiI2MWJjODJiOC0yN2VlLTRkMDUtYTc0OC1iNmQ3Zjc4NDk4ZmIiLCJ0eXAiOiJSZWZyZXNoIiwiYXpwIjoiZ2VtYXRpayIsImF1dGhfdGltZSI6MCwic2Vzc2lvbl9zdGF0ZSI6IjI4ODU3ODA4LTViMjUtNDViYS1iMzAxLThlZGI0MzUwODM3OCIsInNjb3BlIjoidGktcHJvdmlkZXIifQ.FlfHbsFoC26fcwVzsQ4-m_D7ZaKigWvP7We-X5IlBaA",
  "token_type":"bearer",
  "not-before-policy":0,
  "session_state":"28857808-5b25-45ba-b301-8edb43508378",
  "scope":"ti-provider"
}
----
Exchange the access token for the TI-Provider API Token
[source]
----
curl -X GET "[baseUrl]/ti-provider-authenticate" -H "Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJiMkJXT0w2dmN2QjluMjhnYVRwQ19fQllnXzI1aDljMkN2UGVXbmFGYUVNIn0.eyJqdGkiOiI5YjFkYjQ2ZC0yOThmLTQ0ZGItOTQ3ZC0wODdmYTNkYjQ2YzMiLCJleHAiOjE2Nzg4NjcwMjQsIm5iZiI6MCwiaWF0IjoxNjc4ODY2NzI0LCJpc3MiOiJodHRwOi8vYXV0aC10ZXN0LnZ6ZC50aS1kaWVuc3RlLmRlOjk0NDMvYXV0aC9yZWFsbXMvVEktUHJvdmlkZXIiLCJzdWIiOiI2MWJjODJiOC0yN2VlLTRkMDUtYTc0OC1iNmQ3Zjc4NDk4ZmIiLCJ0eXAiOiJCZWFyZXIiLCJhenAiOiJnZW1hdGlrIiwiYXV0aF90aW1lIjowLCJzZXNzaW9uX3N0YXRlIjoiMjg4NTc4MDgtNWIyNS00NWJhLWIzMDEtOGVkYjQzNTA4Mzc4IiwiYWNyIjoiMSIsInNjb3BlIjoidGktcHJvdmlkZXIiLCJjbGllbnRJZCI6ImdlbWF0aWsiLCJjbGllbnRIb3N0IjoiMTcyLjI0LjQ2LjEwIiwiY2xpZW50QWRkcmVzcyI6IjE3Mi4yNC40Ni4xMCJ9.LUbOr4XlICADdYuyT_SgviTBdXkSKdXQ43Fnp9VF7lr71Zrf0ELWiXkr1SplrMUmJrrbff8SaEzZTyy9Fx32xFTJnkX_Dw3uugbWXcARC-895lotzJ1Je4CJZSNSUSv4m6e86M8L7dfXjXxrbPAh4hH8IFWpudgF0mPG12VQMhaupJu13o2gIzB1GL7dk567_RVWXML8hi4ib6DT5dgZjIHFKKSAeuw99Xq0m1XdkwPCL9t8aIemY9lShQ2obvj70C8jBaIjquNGAScIrn3oTTLXs54XBN-t839M5wU0fxpwwHhuaDpRF-uLmPdQA3zE7MCNJYXkzl9nWdh2dLD31w"
----

This operation returns the TI-Provider API Token. For example:
[source]
----
{
 "access_token":
 "eyJ0eXAiOiJKV1QiLCJhbGciOiJFUzI1NiJ9.eyJpc3MiOiJodHRwczovL2ZoaXItZGlyZWN0b3J5LXRlc3QudnpkLnRpLWRpZW5zdGUuZGUvdGktcHJvdmlkZXItYXV0aGVudGljYXRlIiwiYXVkIjoiaHR0cHM6Ly9maGlyLWRpcmVjdG9yeS10ZXN0LnZ6ZC50aS1kaWVuc3RlLmRlL3RpbS1wcm92aWRlci1zZXJ2aWNlcyIsInN1YiI6ImdlbWF0aWsiLCJpYXQiOjE2Nzg4NzI5NjAsImV4cCI6MTY3ODk1OTM2MCwiY2xpZW50SWQiOiJnZW1hdGlrIn0.hZDJXa-l1OK_B2NE54znl5FYWa5mW01Fw7LOiDo2kNIJOx2HPDCnEqxixd-7m9L34wq8WE4qVaA9jB6BNwX7qw",
  "client_id":"gematik",
  "token_type":"bearer",
  "expires_in":86400
}
----

==== Perform API call - Retrieve federation list

[source]
----
curl -X GET "[baseUrl]/tim-provider-services/FederationList/federationList.jws" -H "Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJFUzI1NiJ9.eyJpc3MiOiJodHRwczovL2ZoaXItZGlyZWN0b3J5LXRlc3QudnpkLnRpLWRpZW5zdGUuZGUvdGktcHJvdmlkZXItYXV0aGVudGljYXRlIiwiYXVkIjoiaHR0cHM6Ly9maGlyLWRpcmVjdG9yeS10ZXN0LnZ6ZC50aS1kaWVuc3RlLmRlL3RpbS1wcm92aWRlci1zZXJ2aWNlcyIsInN1YiI6ImdlbWF0aWsiLCJpYXQiOjE2Nzg4NzI5NjAsImV4cCI6MTY3ODk1OTM2MCwiY2xpZW50SWQiOiJnZW1hdGlrIn0.hZDJXa-l1OK_B2NE54znl5FYWa5mW01Fw7LOiDo2kNIJOx2HPDCnEqxixd-7m9L34wq8WE4qVaA9jB6BNwX7qw"
----
This operation returns the federation list. For example:
[source]
----
eyJ4NWMiOlsiTUZvd0ZBWUhLb1pJemowQ0FRWUpLeVFEQXdJSUFRRUhBMElBQkJpMkt6RlE4bEs0TFMyajJVNnpYTjJkR2w1dG5TSnlGeUNMV3cyM3h1NExhY2RNOGNHY0pPdkI4Z3dwajBzQkZvNnpjMUFBaVhjdEhkbUc1TWFwenlZPSJdLCJ0eXAiOiJKV1QiLCJhbGciOiJFUzI1NiJ9.eyJ2ZXJzaW9uIjoxOCwiaGFzaEFsZ29yaXRobSI6IlNIQS0yNTYiLCJkb21haW5MaXN0IjpbeyJkb21haW4iOiJlZjcyZDQzZDU5YjkxY2NlMzA2NjczMzM2ZDcxMjVkYjBjYmIzMDlhYjY4OTMzZjgwY2UwY2Y1NTcwODgxMGVhIiwidGVsZW1hdGlrSUQiOiIxLTFnZW10ZXN0LW93bmVyLTAwMDEiLCJpc0luc3VyYW5jZSI6ZmFsc2V9LHsiZG9tYWluIjoiZDAyNTc4M2M4YjQ0MzU5YTkxZTU2ZTI0M2VlYTcwYjM0YzViMzAwMGVkMGUyNmFjZjM5Mjg5NWFiNTVlZGU3ZCIsInRlbGVtYXRpa0lEIjoiMS0xZ2VtdGVzdC1vd25lci0wMDAxIiwiaXNJbnN1cmFuY2UiOmZhbHNlfSx7ImRvbWFpbiI6IjVlYjU3YzA4OTI2NmE5Zjc2ODYwYmY3ZDM3OGMzYTRiZmM1N2FjZmZhNTMzZTcyYWViMDIxMmU2YWZjOWYyMjciLCJ0ZWxlbWF0aWtJRCI6IjEtMWdlbXRlc3Qtb3duZXItMDAwMSIsImlzSW5zdXJhbmNlIjpmYWxzZX0seyJkb21haW4iOiJjNDg5Y2FlMWM5MWMwMmZiZGU1MTEyYTM4NGIxZDk4M2JhMDQ0OTkxOGZhZDExMDYzMWYzNDM5Njc2YzhiMGU2IiwidGVsZW1hdGlrSUQiOiIxLTJhcnZ0c3QtYXAwMDAwMDAiLCJpc0luc3VyYW5jZSI6ZmFsc2V9LHsiZG9tYWluIjoiNmFhZjM2NWQ5MzA2YzQ5M2IzMGM0NTNhNGRmYWFiNGJkNWNiY2U1ZGYwZTE3NmNmY2JiZGYwNWEwMGI5MjM3OCIsInRlbGVtYXRpa0lEIjoiMS0yYXJ2dHN0LWFwMDAwMDk0IiwiaXNJbnN1cmFuY2UiOmZhbHNlfSx7ImRvbWFpbiI6IjEwMjBmYmFjZjZhMTJiMTBkMDcxZDdkNzBiZDVlNzU3ZjVkMTNmM2NkNzQ4YWJkNjVlY2EwNjQ4NjIzNThjM2QiLCJ0ZWxlbWF0aWtJRCI6IjEtMmFydnRzdC1hcDAwMDA5NCIsImlzSW5zdXJhbmNlIjpmYWxzZX0seyJkb21haW4iOiIzODBiZjk4ZTZmOGFiYTQ2YzdlMmQxMzQwNWRmNDBkYmRhYmYyMjQ0YmUzNjExNjlhMDY2NTc3MTM3NDViOGExIiwidGVsZW1hdGlrSUQiOiIxLTJhcnZ0c3QtYXAwMDAwMDAiLCJpc0luc3VyYW5jZSI6ZmFsc2V9LHsiZG9tYWluIjoiZWFiMTFkMDI1M2U4YTk1ZjYzM2UzOGNhYTgwNjY5ZWNlMjM1OTk5OTUxMzc2ZWU1ZWE2YTg0NDM5NmM2YWU2MCIsInRlbGVtYXRpa0lEIjoiMS0yYXJ2dHN0LXN5bmMtYXAwMzAyIiwiaXNJbnN1cmFuY2UiOmZhbHNlfSx7ImRvbWFpbiI6IjgyOGY0ZjMxYmY0YjYyM2FkMzlhMDBjNmI5NTJmMDBlNjBjZmI5NGQwYjI2ZGFiZjAxYWQ0YjgyNzlmMWY4ZDUiLCJ0ZWxlbWF0aWtJRCI6IjEtMWFydnRzdC10ZXN0LXRwMDIwMSIsImlzSW5zdXJhbmNlIjpmYWxzZX0seyJkb21haW4iOiI3YWI1YWRiOTUxZmViZjlmNTEzZDhkNDc5ZjI2ODMxNjMxZTk0ZmY0NjAwOTA1OTYyOTY1ZTQ0YjQyOTEwMDBiIiwidGVsZW1hdGlrSUQiOiIxLTFhcnZ0c3QtdGVzdC10cDA0YSIsImlzSW5zdXJhbmNlIjpmYWxzZX0seyJkb21haW4iOiI0ZjlhZDY1NTliYjkzZjg2NTgwM2FjM2Q2YzgyMDhhNWFlNTIxZGMwMzdmYWVjYWU4YzVmMTVkMGJlMDlmMzhhIiwidGVsZW1hdGlrSUQiOiIxLTFhcnZ0c3QtdGVzdC10cDA2LTA0IiwiaXNJbnN1cmFuY2UiOmZhbHNlfSx7ImRvbWFpbiI6ImY4NzU1YjRiODk0MTViZjNkOGI1YTI4ZmI2MzAwYTBhNzE5MDU2NGU0OTQ3YTAzYWE4MTUyZjIwZDc2YTg4MzQiLCJ0ZWxlbWF0aWtJRCI6IjEtMWFydnRzdC10ZXN0LXRwMDUtMDEiLCJpc0luc3VyYW5jZSI6ZmFsc2V9LHsiZG9tYWluIjoiZGM5Nzg1YjFjNDU5ZjJmZjk3NWFjNGY2NWM3YTUwNzRkYTFiYWFiMzc4N2Q5ZDg5OGNkNTE3MWQ5NjdhMTUzNSIsInRlbGVtYXRpa0lEIjoiMS0xYXJ2dHN0LXRlc3QtdHAwNi1hIiwiaXNJbnN1cmFuY2UiOmZhbHNlfSx7ImRvbWFpbiI6ImY2MDQ2OTBmNTg2ZTQzYzRiY2FmMmQ5ODM2MTI4NWE3NGY2NDEzY2M4MTBiMzhhY2FmMTliMDc3ZTAzZDIyN2MiLCJ0ZWxlbWF0aWtJRCI6IjEtMWFydnRzdC10ZXN0LXRwMDYtMDEiLCJpc0luc3VyYW5jZSI6ZmFsc2V9LHsiZG9tYWluIjoiOWZmNDE0NDNlNGUwZDI0YzZkMGNiOGQwYWU2YTEzNWRkYzc3ZjUxZGViMmZmNDI4OWViMjkyZGZkZDY3NjcxMyIsInRlbGVtYXRpa0lEIjoiMS0xYXJ2dHN0LXRlc3QtdHAwNi0wMiIsImlzSW5zdXJhbmNlIjpmYWxzZX0seyJkb21haW4iOiJjNjYwYTMyN2QwNWMzNjNlZWFlN2ZhN2M0MWRkODY2ZmEzMzJmN2M2OTdiODllZThjMWU5YWNjNzA5ODRjOTFlIiwidGVsZW1hdGlrSUQiOiJ0cDA2YXJ2dHN0LXRlc3QtdHAwNi0wMyIsImlzSW5zdXJhbmNlIjpmYWxzZX0seyJkb21haW4iOiIzNTk3YzlmZGE3YmFjYmRiOTBkOGU5ZGE1ZDA1OWFlNDcyOTI0NThhMjg5MWJmZTdlYmM5ODI0OWM0YzdhMzljIiwidGVsZW1hdGlrSUQiOiIxLTFhcnZ0c3QtdGVzdC10cDA2LTA1IiwiaXNJbnN1cmFuY2UiOmZhbHNlfSx7ImRvbWFpbiI6ImQ5ODUxZjIzYzFkZGIxYzA5ZjY3MThkNzlhNzAxY2M0MDk1YzIyYjIwNDRlNzFmNzgxODhiMGE0Y2YzZTliZGUiLCJ0ZWxlbWF0aWtJRCI6IjEtMWFydnRzdC10ZXN0LXRwMDYwNiIsImlzSW5zdXJhbmNlIjpmYWxzZX0seyJkb21haW4iOiIxODI0MzBiMTZkNDY3YzczMWMzMWI4MGMzYmE4OWUzMDMxM2FmYzU3ZDkyZWU4ZWNhZTA0MjQ0ZmRlOGQyNjg4IiwidGVsZW1hdGlrSUQiOiIxLTFhcnZ0c3QtdGVzdC10cDA3IiwiaXNJbnN1cmFuY2UiOmZhbHNlfSx7ImRvbWFpbiI6ImM2NGQzZWZiYzI3OTdkODRjY2U4YzQ2MDAxM2RhMWYxOGIxYTU1NjM1ZWFlMGFhMThlOWNmZDEwYTNhYzI0ZDgiLCJ0ZWxlbWF0aWtJRCI6IjEtMWFydnRzdC10ZXN0LXRwMDctMDMiLCJpc0luc3VyYW5jZSI6ZmFsc2V9LHsiZG9tYWluIjoiMzM1MmFmMWFlOGRjZjgyOWNiMzRiN2VhNjY0OTQ5MDEzMzg1ODYwZjJlMWU0MGM1NTEyZWFhOTY4ODdiN2U2MSIsInRlbGVtYXRpa0lEIjoiMS0xYXJ2dHN0LXRlc3QtdHAwOC0wMSIsImlzSW5zdXJhbmNlIjpmYWxzZX0seyJkb21haW4iOiJiNGFlMzc5NmE3ZDlhZjNjN2I2Y2E3NTkzNjFlOWFkOTJmOTQ2ZTdmYWQ3NmRkZWRkMTMzZTllMGE2NTAxODU4IiwidGVsZW1hdGlrSUQiOiIxLTFhcnZ0c3QtdGVzdG9yZy10cDA5LjAwIiwiaXNJbnN1cmFuY2UiOmZhbHNlfSx7ImRvbWFpbiI6ImU3ZGY2NGY5NDU0ZGQwMDc2NzFmZDUyNTNiY2M2YzBjOWZlYmQzMGFlMjFmNDdiNDBmYWU0NzNlZDQ3MDY3MzQiLCJ0ZWxlbWF0aWtJRCI6IjEtMWFydnRzdC10ZXN0b3JnLXRwMDkuMDEiLCJpc0luc3VyYW5jZSI6ZmFsc2V9LHsiZG9tYWluIjoiODk0NTczZTdmYmE2NjE4MTUwZmQxY2QzNTA5NDk0YTVhNjY1YzVmNGJmZDRjNjgyOWZmYTk1MzQ1ZmNhNTFiMCIsInRlbGVtYXRpa0lEIjoiMS0xYXJ2dHN0LXRlc3RvcmctdHAwOS4wMiIsImlzSW5zdXJhbmNlIjpmYWxzZX1dfQ.EjIT7rzdp6XFFzbBfpyanhQNQlOtno98ycqBkgHk3Q8vQKLv7HOGlNV-Y5ZdFU8R68T3hopVKM8X4Xr14uCr1g
----
