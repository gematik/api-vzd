<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1241.6667px" preserveAspectRatio="none" style="width:1453px;height:1241px;background:#FFFFFF;" version="1.1" viewBox="0 0 1453 1241" width="1453.125px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="1043.9372" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="185.4167" y="95.1009"/><rect fill="#FFFFFF" height="503.5319" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="522.9167" y="635.5062"/><rect fill="#FFFFFF" height="273.3968" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="811.4583" y="308.7077"/><rect fill="#FFFFFF" height="122.5667" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1212.5" y="778.7679"/><rect fill="#FFFFFF" height="46.11" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1212.5" y="964.1113"/><rect fill="#FFFFFF" height="30.3467" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1356.25" y="248.0143"/><rect fill="#FFFFFF" height="46.11" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1356.25" y="414.4694"/><rect height="382.2835" style="stroke:#000000;stroke-width:1.5625;fill:none;" width="1346.3542" x="100.5208" y="208.1543"/><rect height="170.7601" style="stroke:#000000;stroke-width:1.5625;fill:none;" width="814.0625" x="472.3958" y="738.9079"/><rect height="94.3034" style="stroke:#000000;stroke-width:1.5625;fill:none;" width="814.0625" x="472.3958" y="924.2513"/><line style="stroke:#181818;stroke-width:0.5208333333333334;fill:none;stroke-dasharray:5.0,5.0;" x1="32.2917" x2="32.2917" y1="84.6842" y2="1157.7881"/><line style="stroke:#181818;stroke-width:0.5208333333333334;fill:none;stroke-dasharray:5.0,5.0;" x1="190.1042" x2="190.1042" y1="84.6842" y2="1157.7881"/><line style="stroke:#181818;stroke-width:0.5208333333333334;fill:none;stroke-dasharray:5.0,5.0;" x1="527.6042" x2="527.6042" y1="84.6842" y2="1157.7881"/><line style="stroke:#181818;stroke-width:0.5208333333333334;fill:none;stroke-dasharray:5.0,5.0;" x1="816.1458" x2="816.1458" y1="84.6842" y2="1157.7881"/><line style="stroke:#181818;stroke-width:0.5208333333333334;fill:none;stroke-dasharray:5.0,5.0;" x1="1217.7083" x2="1217.7083" y1="84.6842" y2="1157.7881"/><line style="stroke:#181818;stroke-width:0.5208333333333334;fill:none;stroke-dasharray:5.0,5.0;" x1="1361.4583" x2="1361.4583" y1="84.6842" y2="1157.7881"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="47.9167" x="5.2083" y="81.2449">Nutzer</text><ellipse cx="32.2917" cy="14.0625" fill="#E3E3E3" rx="8.3333" ry="8.3333" style="stroke:#181818;stroke-width:0.5208333333333334;"/><path d="M32.2917,22.3958 L32.2917,50.5208 M18.75,30.7292 L45.8333,30.7292 M32.2917,50.5208 L18.75,66.1458 M32.2917,50.5208 L45.8333,66.1458 " fill="none" style="stroke:#181818;stroke-width:0.5208333333333334;"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="47.9167" x="5.2083" y="1170.283">Nutzer</text><ellipse cx="32.2917" cy="1182.5765" fill="#E3E3E3" rx="8.3333" ry="8.3333" style="stroke:#181818;stroke-width:0.5208333333333334;"/><path d="M32.2917,1190.9098 L32.2917,1219.0348 M18.75,1199.2432 L45.8333,1199.2432 M32.2917,1219.0348 L18.75,1234.6598 M32.2917,1219.0348 L45.8333,1234.6598 " fill="none" style="stroke:#181818;stroke-width:0.5208333333333334;"/><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="159.375" x="110.9375" y="52.0833"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="144.7917" x="118.2292" y="72.9116">TI-Messenger-Client</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="159.375" x="110.9375" y="1156.7464"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="144.7917" x="118.2292" y="1177.5747">TI-Messenger-Client</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="90.625" x="482.8125" y="52.0833"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="76.0417" x="490.1042" y="72.9116">FHIR-Proxy</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="90.625" x="482.8125" y="1156.7464"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="76.0417" x="490.1042" y="1177.5747">FHIR-Proxy</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="105.2083" x="764.0625" y="52.0833"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="90.625" x="771.3542" y="72.9116">Auth-Service</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="105.2083" x="764.0625" y="1156.7464"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="90.625" x="771.3542" y="1177.5747">Auth-Service</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="116.6667" x="1159.375" y="52.0833"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="102.0833" x="1166.6667" y="72.9116">FHIR-Directory</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="116.6667" x="1159.375" y="1156.7464"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="102.0833" x="1166.6667" y="1177.5747">FHIR-Directory</text><rect fill="#E3E3E3" height="48.5352" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="150" x="1286.4583" y="35.1074"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="134.375" x="1294.2708" y="55.9357">Matrix-Homeserver</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="135.4167" x="1293.75" y="72.9116">(Messenger-Proxy)</text><rect fill="#E3E3E3" height="48.5352" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="150" x="1286.4583" y="1156.7464"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="134.375" x="1294.2708" y="1177.5747">Matrix-Homeserver</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="135.4167" x="1293.75" y="1194.5506">(Messenger-Proxy)</text><rect fill="#FFFFFF" height="1043.9372" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="185.4167" y="95.1009"/><rect fill="#FFFFFF" height="503.5319" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="522.9167" y="635.5062"/><rect fill="#FFFFFF" height="273.3968" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="811.4583" y="308.7077"/><rect fill="#FFFFFF" height="122.5667" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1212.5" y="778.7679"/><rect fill="#FFFFFF" height="46.11" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1212.5" y="964.1113"/><rect fill="#FFFFFF" height="30.3467" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1356.25" y="248.0143"/><rect fill="#FFFFFF" height="46.11" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1356.25" y="414.4694"/><polygon fill="#181818" points="172.9167,128.7109,183.3333,132.8776,172.9167,137.0443,177.0833,132.8776" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="32.2917" x2="179.1667" y1="132.8776" y2="132.8776"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="63.5417" x="39.5833" y="111.8373">gibt FHIR-</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="128.125" x="39.5833" y="127.6006">Suchparameter ein</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="195.8333" x2="239.5833" y1="178.9876" y2="178.9876"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="239.5833" x2="239.5833" y1="178.9876" y2="192.5293"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="196.875" x2="239.5833" y1="192.5293" y2="192.5293"/><polygon fill="#181818" points="207.2917,188.3626,196.875,192.5293,207.2917,196.696,203.125,192.5293" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="312.5" x="203.125" y="157.9473">prüfe ob noch gültiges tim-search-accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="157.2917" x="203.125" y="173.7106">vom FHIR-Proxy vorliegt</text><path d="M100.5208,208.1543 L167.1875,208.1543 L167.1875,215.5843 L156.7708,226.001 L100.5208,226.001 L100.5208,208.1543 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5625;"/><rect fill="none" height="382.2835" style="stroke:#000000;stroke-width:1.5625;" width="1346.3542" x="100.5208" y="208.1543"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" font-weight="bold" lengthAdjust="spacing" textLength="19.7917" x="116.1458" y="221.7656">alt</text><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="335.4167" x="182.8125" y="220.8735">[kein gültiges tim-search-accesstoken vorhanden]</text><polygon fill="#181818" points="1343.75,243.8477,1354.1667,248.0143,1343.75,252.181,1347.9167,248.0143" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="195.8333" x2="1350" y1="248.0143" y2="248.0143"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="394.7917" x="203.125" y="242.7373">POST /_matrix/client/r0/user/{userId}/openid/request_token</text><polygon fill="#181818" points="207.2917,274.1943,196.875,278.361,207.2917,282.5277,203.125,278.361" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="201.0417" x2="1360.4167" y1="278.361" y2="278.361"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="750" x="213.5417" y="273.084">HTTP 200 OK, Result body {"access_token": "Matrix-OpenID-Token",..., "matrix_server_name": "example.com",...}</text><polygon fill="#181818" points="798.9583,304.541,809.375,308.7077,798.9583,312.8743,803.125,308.7077" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="195.8333" x2="805.2083" y1="308.7077" y2="308.7077"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="427.0833" x="203.125" y="303.4307">GET /tim-authenticate... (Auth Header mit Matrix-OpenID-Token)</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="821.875" x2="865.625" y1="354.8177" y2="354.8177"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="865.625" x2="865.625" y1="354.8177" y2="368.3594"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="822.9167" x2="865.625" y1="368.3594" y2="368.3594"/><polygon fill="#181818" points="833.3333,364.1927,822.9167,368.3594,833.3333,372.526,829.1667,368.3594" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="196.875" x="829.1667" y="333.7774">Prüfe ob matrix_server_name</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="188.5417" x="829.1667" y="349.5407">in Föderationsliste enthalten</text><polygon fill="#181818" points="1343.75,410.3027,1354.1667,414.4694,1343.75,418.6361,1347.9167,414.4694" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="821.875" x2="1350" y1="414.4694" y2="414.4694"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="147.9167" x="829.1667" y="393.4291">GET /openid/userinfo/?</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="246.875" x="829.1667" y="409.1924">access_token=Matrix-OpenID-Token)</text><polygon fill="#181818" points="833.3333,456.4128,822.9167,460.5794,833.3333,464.7461,829.1667,460.5794" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="827.0833" x2="1360.4167" y1="460.5794" y2="460.5794"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="85.4167" x="839.5833" y="439.5391">HTTP 200 OK</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="210.4167" x="839.5833" y="455.3024">(Result Body MXID des Nutzers)</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="821.875" x2="865.625" y1="490.9261" y2="490.9261"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="865.625" x2="865.625" y1="490.9261" y2="504.4678"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="822.9167" x2="865.625" y1="504.4678" y2="504.4678"/><polygon fill="#181818" points="833.3333,500.3011,822.9167,504.4678,833.3333,508.6344,829.1667,504.4678" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="376.0417" x="829.1667" y="485.6491">erzeuge tim-search-accesstoken für TI-Messenger-Client</text><polygon fill="#181818" points="207.2917,577.9378,196.875,582.1045,207.2917,586.2712,203.125,582.1045" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="201.0417" x2="815.625" y1="582.1045" y2="582.1045"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="170.8333" x="213.5417" y="529.5375">HTTP 200 OK, Result body</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="218.75" x="213.5417" y="545.3008">{"access_token"="accesstoken",</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="146.875" x="213.5417" y="561.0641">"token_type":"bearer",</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="131.25" x="213.5417" y="576.8275">"expires_in":86400}</text><polygon fill="#181818" points="510.4167,631.3395,520.8333,635.5062,510.4167,639.6729,514.5833,635.5062" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="195.8333" x2="516.6667" y1="635.5062" y2="635.5062"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="245.8333" x="203.125" y="614.4658">GET /tim-search?... (Auth Header mit</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="165.625" x="203.125" y="630.2292">tim-search-accesstoken)</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="533.3333" x2="577.0833" y1="665.8529" y2="665.8529"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="577.0833" x2="577.0833" y1="665.8529" y2="679.3945"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="534.375" x2="577.0833" y1="679.3945" y2="679.3945"/><polygon fill="#181818" points="544.7917,675.2279,534.375,679.3945,544.7917,683.5612,540.625,679.3945" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="198.9583" x="540.625" y="660.5759">prüfe tim-search-accesstoken</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="533.3333" x2="577.0833" y1="709.7412" y2="709.7412"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="577.0833" x2="577.0833" y1="709.7412" y2="723.2829"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="534.375" x2="577.0833" y1="723.2829" y2="723.2829"/><polygon fill="#181818" points="544.7917,719.1162,534.375,723.2829,544.7917,727.4495,540.625,723.2829" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="263.5417" x="540.625" y="704.4642">werden TIPractitioner-Einträge gesucht?</text><path d="M472.3958,738.9079 L539.0625,738.9079 L539.0625,746.3379 L528.6458,756.7546 L472.3958,756.7546 L472.3958,738.9079 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5625;"/><rect fill="none" height="170.7601" style="stroke:#000000;stroke-width:1.5625;" width="814.0625" x="472.3958" y="738.9079"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" font-weight="bold" lengthAdjust="spacing" textLength="19.7917" x="488.0208" y="752.5192">alt</text><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="303.125" x="554.6875" y="751.6271">[TIPractitionerRole-Einträge werden gesucht]</text><polygon fill="#181818" points="1200,774.6012,1210.4167,778.7679,1200,782.9346,1204.1667,778.7679" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="533.3333" x2="1206.25" y1="778.7679" y2="778.7679"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="159.375" x="540.625" y="773.4909">GET /?...&lt;eigene MXID&gt;</text><polygon fill="#181818" points="544.7917,820.7113,534.375,824.8779,544.7917,829.0446,540.625,824.8779" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="538.5417" x2="1211.4583" y1="824.8779" y2="824.8779"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="85.4167" x="551.0417" y="803.8376">HTTP 200 OK</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="288.5417" x="551.0417" y="819.6009">(Result Body json mit TIPractitioner-Eintrag)</text><polygon fill="#181818" points="1200,851.0579,1210.4167,855.2246,1200,859.3913,1204.1667,855.2246" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="533.3333" x2="1206.25" y1="855.2246" y2="855.2246"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="54.1667" x="540.625" y="849.9476">GET /?...</text><polygon fill="#181818" points="544.7917,897.168,534.375,901.3346,544.7917,905.5013,540.625,901.3346" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="538.5417" x2="1216.6667" y1="901.3346" y2="901.3346"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="85.4167" x="551.0417" y="880.2943">HTTP 200 OK</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="119.7917" x="551.0417" y="896.0576">(Result Body json)</text><path d="M472.3958,924.2513 L539.0625,924.2513 L539.0625,931.6813 L528.6458,942.098 L472.3958,942.098 L472.3958,924.2513 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5625;"/><rect fill="none" height="94.3034" style="stroke:#000000;stroke-width:1.5625;" width="814.0625" x="472.3958" y="924.2513"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" font-weight="bold" lengthAdjust="spacing" textLength="19.7917" x="488.0208" y="937.8627">alt</text><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="317.7083" x="554.6875" y="936.9705">[TIHealthcareService-Einträge werden gesucht]</text><polygon fill="#181818" points="1200,959.9447,1210.4167,964.1113,1200,968.278,1204.1667,964.1113" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="533.3333" x2="1206.25" y1="964.1113" y2="964.1113"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="54.1667" x="540.625" y="958.8343">GET /?...</text><polygon fill="#181818" points="544.7917,1006.0547,534.375,1010.2214,544.7917,1014.388,540.625,1010.2214" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="538.5417" x2="1216.6667" y1="1010.2214" y2="1010.2214"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="85.4167" x="551.0417" y="989.181">HTTP 200 OK</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="119.7917" x="551.0417" y="1004.9444">(Result Body json)</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="533.3333" x2="577.0833" y1="1079.3864" y2="1079.3864"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="577.0833" x2="577.0833" y1="1079.3864" y2="1092.9281"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="534.375" x2="577.0833" y1="1092.9281" y2="1092.9281"/><polygon fill="#181818" points="544.7917,1088.7614,534.375,1092.9281,544.7917,1097.0947,540.625,1092.9281" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="92.7083" x="540.625" y="1042.5827">prüfe telecom</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="63.5417" x="540.625" y="1058.346">Elemente</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="153.125" x="540.625" y="1074.1094">und ergänze PASSporT</text><polygon fill="#181818" points="202.0833,1134.8714,191.6667,1139.0381,202.0833,1143.2048,197.9167,1139.0381" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="195.8333" x2="527.0833" y1="1139.0381" y2="1139.0381"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="230.2083" x="208.3333" y="1117.9977">HTTP 200 OK (Result Body json mit</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="137.5" x="208.3333" y="1133.7611">MXID und PASSporT)</text><!--MD5=[73913b844a5cd1ded8a0cc072c330214]
@startuml SequenceDiagram.FHIR-Directory.tim-search
skinparam dpi 100
skinparam WrapWidth 200
skinparam monochrome true

'title "FHIR-Directory, Sequenzdiagram tim-search'
actor Nutzer
participant cl as "TI-Messenger-Client"
participant fp as "FHIR-Proxy"
participant au as "Auth-Service"
participant fd as "FHIR-Directory"
participant hs as "Matrix-Homeserver\n(Messenger-Proxy)"
activate cl
Nutzer -> cl:gibt FHIR-\nSuchparameter ein
cl -> cl: prüfe ob noch gültiges tim-search-accesstoken\nvom FHIR-Proxy vorliegt
alt kein gültiges tim-search-accesstoken vorhanden
cl -> hs: POST /_matrix/client/r0/user/{userId}/openid/request_token
activate hs
hs - -> cl: HTTP 200 OK, Result body {"access_token": "Matrix-OpenID-Token",..., "matrix_server_name": "example.com",...}
deactivate hs
cl -> au: GET /tim-authenticate... (Auth Header mit Matrix-OpenID-Token)
activate au
au -> au: Prüfe ob matrix_server_name\nin Föderationsliste enthalten
au -> hs: GET /openid/userinfo/?\naccess_token=Matrix-OpenID-Token)
activate hs
hs - -> au: HTTP 200 OK\n(Result Body MXID des Nutzers)
deactivate hs
au -> au: erzeuge tim-search-accesstoken für TI-Messenger-Client
au - -> cl: HTTP 200 OK, Result body\n{"access_token"="accesstoken",\n"token_type":"bearer",\n"expires_in":86400}
deactivate au
end
cl -> fp: GET /tim-search?... (Auth Header mit\ntim-search-accesstoken)
activate fp
fp -> fp: prüfe tim-search-accesstoken
fp -> fp: werden TIPractitioner-Einträge gesucht?
alt TIPractitionerRole-Einträge werden gesucht
fp -> fd: GET /?...<eigene MXID>
activate fd
fd - -> fp: HTTP 200 OK\n(Result Body json mit TIPractitioner-Eintrag)
fp -> fd: GET /?...
fd - -> fp: HTTP 200 OK\n(Result Body json)
deactivate fd
end
alt TIHealthcareService-Einträge werden gesucht
fp -> fd: GET /?...
activate fd
fd - -> fp: HTTP 200 OK\n(Result Body json)
deactivate fd
end
fp -> fp: prüfe telecom\nElemente\nund ergänze PASSporT
fp - -> cl: HTTP 200 OK (Result Body json mit\nMXID und PASSporT)
deactivate fp
deactivate cl
@enduml

@startuml SequenceDiagram.FHIR-Directory.tim-search
skinparam dpi 100
skinparam WrapWidth 200
skinparam monochrome true

actor Nutzer
participant cl as "TI-Messenger-Client"
participant fp as "FHIR-Proxy"
participant au as "Auth-Service"
participant fd as "FHIR-Directory"
participant hs as "Matrix-Homeserver\n(Messenger-Proxy)"
activate cl
Nutzer -> cl:gibt FHIR-\nSuchparameter ein
cl -> cl: prüfe ob noch gültiges tim-search-accesstoken\nvom FHIR-Proxy vorliegt
alt kein gültiges tim-search-accesstoken vorhanden
cl -> hs: POST /_matrix/client/r0/user/{userId}/openid/request_token
activate hs
hs - -> cl: HTTP 200 OK, Result body {"access_token": "Matrix-OpenID-Token",..., "matrix_server_name": "example.com",...}
deactivate hs
cl -> au: GET /tim-authenticate... (Auth Header mit Matrix-OpenID-Token)
activate au
au -> au: Prüfe ob matrix_server_name\nin Föderationsliste enthalten
au -> hs: GET /openid/userinfo/?\naccess_token=Matrix-OpenID-Token)
activate hs
hs - -> au: HTTP 200 OK\n(Result Body MXID des Nutzers)
deactivate hs
au -> au: erzeuge tim-search-accesstoken für TI-Messenger-Client
au - -> cl: HTTP 200 OK, Result body\n{"access_token"="accesstoken",\n"token_type":"bearer",\n"expires_in":86400}
deactivate au
end
cl -> fp: GET /tim-search?... (Auth Header mit\ntim-search-accesstoken)
activate fp
fp -> fp: prüfe tim-search-accesstoken
fp -> fp: werden TIPractitioner-Einträge gesucht?
alt TIPractitionerRole-Einträge werden gesucht
fp -> fd: GET /?...<eigene MXID>
activate fd
fd - -> fp: HTTP 200 OK\n(Result Body json mit TIPractitioner-Eintrag)
fp -> fd: GET /?...
fd - -> fp: HTTP 200 OK\n(Result Body json)
deactivate fd
end
alt TIHealthcareService-Einträge werden gesucht
fp -> fd: GET /?...
activate fd
fd - -> fp: HTTP 200 OK\n(Result Body json)
deactivate fd
end
fp -> fp: prüfe telecom\nElemente\nund ergänze PASSporT
fp - -> cl: HTTP 200 OK (Result Body json mit\nMXID und PASSporT)
deactivate fp
deactivate cl
@enduml

PlantUML version 1.2022.5(Sat Apr 30 10:55:52 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>