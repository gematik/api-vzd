<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1205.2083px" preserveAspectRatio="none" style="width:1783px;height:1205px;background:#FFFFFF;" version="1.1" viewBox="0 0 1783 1205" width="1783.3333px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="935.9619" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="250.5208" y="149.8535"/><rect fill="#FFFFFF" height="195.6217" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="564.0625" y="545.0602"/><rect fill="#FFFFFF" height="562.4268" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="769.2708" y="350.8219"/><rect fill="#FFFFFF" height="134.9284" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1114.0625" y="950.887"/><rect fill="#FFFFFF" height="256.3151" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1305.7292" y="575.4069"/><rect fill="#FFFFFF" height="60.6934" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1518.2292" y="1025.1221"/><rect fill="#FFFFFF" height="30.3467" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1669.2708" y="290.1286"/><rect fill="none" height="696.4518" style="stroke:#000000;stroke-width:1.5625;" width="1622.3958" x="155.2083" y="225.1302"/><rect fill="none" height="589.7868" style="stroke:#000000;stroke-width:1.5625;" width="1601.5625" x="165.625" y="250.2686"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="45.8333" x2="45.8333" y1="101.6602" y2="1104.5654"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="255.2083" x2="255.2083" y1="101.6602" y2="1104.5654"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="569.2708" x2="569.2708" y1="101.6602" y2="1104.5654"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="773.9583" x2="773.9583" y1="101.6602" y2="1104.5654"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="1118.75" x2="1118.75" y1="101.6602" y2="1104.5654"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="1310.9375" x2="1310.9375" y1="101.6602" y2="1104.5654"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="1523.4375" x2="1523.4375" y1="101.6602" y2="1104.5654"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="1674.4792" x2="1674.4792" y1="101.6602" y2="1104.5654"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="76.0417" x="5.2083" y="81.2449">Org-Admin</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="54.1667" x="16.1458" y="98.2208">oder LE</text><ellipse cx="46.3542" cy="14.0625" fill="#E3E3E3" rx="8.3333" ry="8.3333" style="stroke:#181818;stroke-width:0.5208333333333334;"/><path d="M46.3542,22.3958 L46.3542,50.5208 M32.8125,30.7292 L59.8958,30.7292 M46.3542,50.5208 L32.8125,66.1458 M46.3542,50.5208 L59.8958,66.1458 " fill="none" style="stroke:#181818;stroke-width:0.5208333333333334;"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="76.0417" x="5.2083" y="1117.0603">Org-Admin</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="54.1667" x="16.1458" y="1134.0363">oder LE</text><ellipse cx="46.3542" cy="1146.3298" fill="#E3E3E3" rx="8.3333" ry="8.3333" style="stroke:#181818;stroke-width:0.5208333333333334;"/><path d="M46.3542,1154.6631 L46.3542,1182.7881 M32.8125,1162.9964 L59.8958,1162.9964 M46.3542,1182.7881 L32.8125,1198.4131 M46.3542,1182.7881 L59.8958,1198.4131 " fill="none" style="stroke:#181818;stroke-width:0.5208333333333334;"/><rect fill="#E3E3E3" height="65.5111" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="159.375" x="176.0417" y="35.1074"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="121.875" x="194.7917" y="55.9357">Org-Admin-Client</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="33.3333" x="239.0625" y="72.9116">oder</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="144.7917" x="183.3333" y="89.8875">TI-Messenger-Client</text><rect fill="#E3E3E3" height="65.5111" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="159.375" x="176.0417" y="1103.5238"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="121.875" x="194.7917" y="1124.352">Org-Admin-Client</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="33.3333" x="239.0625" y="1141.3279">oder</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="144.7917" x="183.3333" y="1158.3038">TI-Messenger-Client</text><rect fill="#E3E3E3" height="48.5352" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="143.75" x="497.3958" y="52.0833"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="129.1667" x="504.6875" y="72.9116">Authenticator App</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="55.2083" x="541.6667" y="89.8875">des IDP</text><rect fill="#E3E3E3" height="48.5352" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="143.75" x="497.3958" y="1103.5238"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="129.1667" x="504.6875" y="1124.352">Authenticator App</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="55.2083" x="541.6667" y="1141.3279">des IDP</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="105.2083" x="721.875" y="69.0592"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="90.625" x="729.1667" y="89.8875">Auth-Service</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="105.2083" x="721.875" y="1103.5238"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="90.625" x="729.1667" y="1124.352">Auth-Service</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="90.625" x="1073.9583" y="69.0592"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="76.0417" x="1081.25" y="89.8875">FHIR-Proxy</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="90.625" x="1073.9583" y="1103.5238"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="76.0417" x="1081.25" y="1124.352">FHIR-Proxy</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="129.1667" x="1246.3542" y="69.0592"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="114.5833" x="1253.6458" y="89.8875">Identity Provider</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="129.1667" x="1246.3542" y="1103.5238"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="114.5833" x="1253.6458" y="1124.352">Identity Provider</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="116.6667" x="1465.1042" y="69.0592"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="102.0833" x="1472.3958" y="89.8875">FHIR-Directory</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="116.6667" x="1465.1042" y="1103.5238"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="102.0833" x="1472.3958" y="1124.352">FHIR-Directory</text><rect fill="#E3E3E3" height="48.5352" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="164.5833" x="1592.1875" y="52.0833"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="98.9583" x="1625" y="72.9116">TI-Messenger</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="150" x="1599.4792" y="89.8875">Registrierungsdienst</text><rect fill="#E3E3E3" height="48.5352" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="164.5833" x="1592.1875" y="1103.5238"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="98.9583" x="1625" y="1124.352">TI-Messenger</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="150" x="1599.4792" y="1141.3279">Registrierungsdienst</text><rect fill="#FFFFFF" height="935.9619" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="250.5208" y="149.8535"/><rect fill="#FFFFFF" height="195.6217" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="564.0625" y="545.0602"/><rect fill="#FFFFFF" height="562.4268" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="769.2708" y="350.8219"/><rect fill="#FFFFFF" height="134.9284" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1114.0625" y="950.887"/><rect fill="#FFFFFF" height="256.3151" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1305.7292" y="575.4069"/><rect fill="#FFFFFF" height="60.6934" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1518.2292" y="1025.1221"/><rect fill="#FFFFFF" height="30.3467" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1669.2708" y="290.1286"/><polygon fill="#181818" points="238.0208,145.6868,248.4375,149.8535,238.0208,154.0202,242.1875,149.8535" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="46.3542" x2="244.2708" y1="149.8535" y2="149.8535"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="184.375" x="53.6458" y="128.8132">möchte seinen FHIR-Eintrag</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="46.875" x="53.6458" y="144.5765">ändern</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="260.9375" x2="304.6875" y1="195.9635" y2="195.9635"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="304.6875" x2="304.6875" y1="195.9635" y2="209.5052"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="261.9792" x2="304.6875" y1="209.5052" y2="209.5052"/><polygon fill="#181818" points="272.3958,205.3385,261.9792,209.5052,272.3958,213.6719,268.2292,209.5052" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="280.2083" x="268.2292" y="174.9232">prüfe ob noch gültiges owner-accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="288.5417" x="268.2292" y="190.6865">für Schreibzugriff vom Auth-Service vorliegt</text><path d="M155.2083,225.1302 L221.875,225.1302 L221.875,232.5602 L211.4583,242.9769 L155.2083,242.9769 L155.2083,225.1302 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5625;"/><rect fill="none" height="696.4518" style="stroke:#000000;stroke-width:1.5625;" width="1622.3958" x="155.2083" y="225.1302"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" font-weight="bold" lengthAdjust="spacing" textLength="19.7917" x="170.8333" y="238.7416">alt</text><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="427.0833" x="237.5" y="237.8494">[kein gültiges owner-accesstoken für Schreibzugriff vorhanden]</text><path d="M165.625,250.2686 L232.2917,250.2686 L232.2917,257.6986 L221.875,268.1152 L165.625,268.1152 L165.625,250.2686 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5625;"/><rect fill="none" height="589.7868" style="stroke:#000000;stroke-width:1.5625;" width="1601.5625" x="165.625" y="250.2686"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" font-weight="bold" lengthAdjust="spacing" textLength="19.7917" x="181.25" y="263.8799">alt</text><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="80.2083" x="247.9167" y="262.9878">[Org-Admin]</text><polygon fill="#181818" points="1656.7708,285.9619,1667.1875,290.1286,1656.7708,294.2952,1660.9375,290.1286" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="260.9375" x2="1663.0208" y1="290.1286" y2="290.1286"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="307.2917" x="268.2292" y="284.8516">POST /regservice/user/{userId}/request_token</text><polygon fill="#181818" points="272.3958,316.3086,261.9792,320.4753,272.3958,324.6419,268.2292,320.4753" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="266.1458" x2="1673.4375" y1="320.4753" y2="320.4753"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="552.0833" x="278.6458" y="315.1983">HTTP 200 OK, Result body {"access_token": "RegService-OpenID-Token=id_token"}</text><polygon fill="#181818" points="756.7708,346.6553,767.1875,350.8219,756.7708,354.9886,760.9375,350.8219" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="260.9375" x2="763.0208" y1="350.8219" y2="350.8219"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="488.5417" x="268.2292" y="345.5449">GET /owner-authenticate... ((Auth Header mit RegService-OpenID-Token))</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="779.6875" x2="823.4375" y1="381.1686" y2="381.1686"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="823.4375" x2="823.4375" y1="381.1686" y2="394.7103"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="780.7292" x2="823.4375" y1="394.7103" y2="394.7103"/><polygon fill="#181818" points="791.1458,390.5436,780.7292,394.7103,791.1458,398.877,786.9792,394.7103" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="319.7917" x="786.9792" y="375.8916">verify RegService-OpenID-Token (telematikID,...)</text><line style="stroke:#000000;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="165.625" x2="1767.1875" y1="404.0853" y2="404.0853"/><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="250" x="170.8333" y="414.7212">[LE mit HBA und TI-Messenger Client]</text><polygon fill="#181818" points="756.7708,436.3118,767.1875,440.4785,756.7708,444.6452,760.9375,440.4785" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="260.9375" x2="763.0208" y1="440.4785" y2="440.4785"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="163.5417" x="268.2292" y="435.2015">GET /owner-authenticate</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="779.6875" x2="823.4375" y1="470.8252" y2="470.8252"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="823.4375" x2="823.4375" y1="470.8252" y2="484.3669"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="780.7292" x2="823.4375" y1="484.3669" y2="484.3669"/><polygon fill="#181818" points="791.1458,480.2002,780.7292,484.3669,791.1458,488.5335,786.9792,484.3669" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="298.9583" x="786.9792" y="465.5482">Erzeuge PKCE Code für verifier und challenge</text><polygon fill="#181818" points="272.3958,510.5469,261.9792,514.7135,272.3958,518.8802,268.2292,514.7135" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="266.1458" x2="768.2292" y1="514.7135" y2="514.7135"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="292.7083" x="278.6458" y="509.4365">Redirect (302) to IDP Authorization Endpoint</text><polygon fill="#181818" points="551.5625,540.8936,561.9792,545.0602,551.5625,549.2269,555.7292,545.0602" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="260.9375" x2="557.8125" y1="545.0602" y2="545.0602"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="176.0417" x="268.2292" y="539.7832">Deeplink authenticator://...</text><polygon fill="#181818" points="1293.2292,571.2402,1303.6458,575.4069,1293.2292,579.5736,1297.3958,575.4069" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="574.4792" x2="1299.4792" y1="575.4069" y2="575.4069"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="142.7083" x="581.7708" y="570.1299">GET {auth_endpoint}</text><polygon fill="#181818" points="585.9375,601.5869,575.5208,605.7536,585.9375,609.9202,581.7708,605.7536" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="579.6875" x2="1304.6875" y1="605.7536" y2="605.7536"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="63.5417" x="592.1875" y="600.4766">challenge</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="574.4792" x2="618.2292" y1="636.1003" y2="636.1003"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="618.2292" x2="618.2292" y1="636.1003" y2="649.6419"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="575.5208" x2="618.2292" y1="649.6419" y2="649.6419"/><polygon fill="#181818" points="585.9375,645.4753,575.5208,649.6419,585.9375,653.8086,581.7708,649.6419" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="94.7917" x="581.7708" y="630.8233">sign challenge</text><polygon fill="#181818" points="1293.2292,675.8219,1303.6458,679.9886,1293.2292,684.1553,1297.3958,679.9886" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="574.4792" x2="1299.4792" y1="679.9886" y2="679.9886"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="114.5833" x="581.7708" y="674.7116">signed_challenge</text><polygon fill="#181818" points="585.9375,706.1686,575.5208,710.3353,585.9375,714.502,581.7708,710.3353" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="579.6875" x2="1304.6875" y1="710.3353" y2="710.3353"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="193.75" x="592.1875" y="705.0583">Redirect (302) {auth_code,..)</text><polygon fill="#181818" points="272.3958,736.5153,261.9792,740.682,272.3958,744.8486,268.2292,740.682" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="266.1458" x2="568.2292" y1="740.682" y2="740.682"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="227.0833" x="278.6458" y="735.405">{client_callback_uri} {auth_code}</text><polygon fill="#181818" points="756.7708,766.862,767.1875,771.0286,756.7708,775.1953,760.9375,771.0286" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="260.9375" x2="763.0208" y1="771.0286" y2="771.0286"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="323.9583" x="268.2292" y="765.7516">GET /signin-gematik-idp-dienst with {auth_code}</text><polygon fill="#181818" points="1293.2292,797.2087,1303.6458,801.3753,1293.2292,805.542,1297.3958,801.3753" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="779.6875" x2="1299.4792" y1="801.3753" y2="801.3753"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="283.3333" x="786.9792" y="796.0983">POST /tokenEndpoint {auth_code, verifier}</text><polygon fill="#181818" points="791.1458,827.5553,780.7292,831.722,791.1458,835.8887,786.9792,831.722" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="784.8958" x2="1309.8958" y1="831.722" y2="831.722"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="141.6667" x="797.3958" y="826.445">Response {id_token}</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="779.6875" x2="823.4375" y1="869.3604" y2="869.3604"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="823.4375" x2="823.4375" y1="869.3604" y2="882.902"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="780.7292" x2="823.4375" y1="882.902" y2="882.902"/><polygon fill="#181818" points="791.1458,878.7354,780.7292,882.902,791.1458,887.0687,786.9792,882.902" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="186.4583" x="786.9792" y="864.0834">erzeuge owner-accesstoken</text><polygon fill="#181818" points="272.3958,909.082,261.9792,913.2487,272.3958,917.4154,268.2292,913.2487" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="266.1458" x2="773.4375" y1="913.2487" y2="913.2487"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="442.7083" x="278.6458" y="907.9717">HTTP 200 OK, Result body {"access_token"="owner-accesstoken"}</text><polygon fill="#181818" points="1101.5625,946.7204,1111.9792,950.887,1101.5625,955.0537,1105.7292,950.887" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="260.9375" x2="1107.8125" y1="950.887" y2="950.887"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="702.0833" x="268.2292" y="945.61">POST /owner/TIHealthcareService (Authorization Bearer owner-accesstoken) {providedBy.id=telematikID}</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="1124.4792" x2="1168.2292" y1="981.2337" y2="981.2337"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="1168.2292" x2="1168.2292" y1="981.2337" y2="994.7754"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="1125.5208" x2="1168.2292" y1="994.7754" y2="994.7754"/><polygon fill="#181818" points="1135.9375,990.6087,1125.5208,994.7754,1135.9375,998.9421,1131.7708,994.7754" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="166.6667" x="1131.7708" y="975.9567">prüfe owner-accesstoken</text><polygon fill="#181818" points="1505.7292,1020.9554,1516.1458,1025.1221,1505.7292,1029.2887,1509.8958,1025.1221" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="1124.4792" x2="1511.9792" y1="1025.1221" y2="1025.1221"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="373.9583" x="1131.7708" y="1019.8451">POST /TIHealthcareService {providedBy.id=telematikID}</text><polygon fill="#181818" points="1135.9375,1051.3021,1125.5208,1055.4688,1135.9375,1059.6354,1131.7708,1055.4688" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="1129.6875" x2="1517.1875" y1="1055.4688" y2="1055.4688"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="209.375" x="1142.1875" y="1050.1918">HTTP 200 OK (Result Body json)</text><polygon fill="#181818" points="267.1875,1081.6488,256.7708,1085.8154,267.1875,1089.9821,263.0208,1085.8154" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="260.9375" x2="1118.2292" y1="1085.8154" y2="1085.8154"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="209.375" x="273.4375" y="1080.5384">HTTP 200 OK (Result Body json)</text><!--MD5=[1de56e6440304ea3979d6b39924e8104]
@startuml

skinparam dpi 100
skinparam WrapWidth 200
skinparam monochrome true

'title "FHIR-Directory, Sequenzdiagram Änderung von eigenen Einträgen'
actor o as "Org-Admin\noder LE"
participant cl as "Org-Admin-Client\noder\nTI-Messenger-Client"
participant aa as "Authenticator App\ndes IDP"
participant au as "Auth-Service"
participant fp as "FHIR-Proxy"
participant idp as "Identity Provider"
participant fd as "FHIR-Directory"
participant rd as "TI-Messenger\nRegistrierungsdienst"
o -> cl: möchte seinen FHIR-Eintrag\nändern
activate cl
cl -> cl: prüfe ob noch gültiges owner-accesstoken\nfür Schreibzugriff vom Auth-Service vorliegt
alt kein gültiges owner-accesstoken für Schreibzugriff vorhanden
alt Org-Admin
cl -> rd: POST /regservice/user/{userId}/request_token
activate rd
rd - -> cl: HTTP 200 OK, Result body {"access_token": "RegService-OpenID-Token=id_token"}
deactivate rd
cl -> au: GET /owner-authenticate... ((Auth Header mit RegService-OpenID-Token))
activate au
au -> au: verify RegService-OpenID-Token (telematikID,...)
else LE mit HBA und TI-Messenger Client
cl -> au: GET /owner-authenticate
au -> au: Erzeuge PKCE Code für verifier und challenge
au - -> cl: Redirect (302) to IDP Authorization Endpoint
cl -> aa: Deeplink authenticator://...
activate aa

aa -> idp: GET {auth_endpoint}
activate idp
idp - -> aa: challenge
aa -> aa: sign challenge
aa-> idp: signed_challenge
idp - -> aa: Redirect (302) {auth_code,..)
aa - -> cl: {client_callback_uri} {auth_code}
deactivate aa

cl -> au: GET /signin-gematik-idp-dienst with {auth_code}
au -> idp: POST /tokenEndpoint {auth_code, verifier}
idp - -> au: Response {id_token}

deactivate idp
end
au -> au: erzeuge owner-accesstoken
au - -> cl: HTTP 200 OK, Result body {"access_token"="owner-accesstoken"}
deactivate au
end
cl -> fp: POST /owner/TIHealthcareService (Authorization Bearer owner-accesstoken) {providedBy.id=telematikID}
activate fp
fp -> fp: prüfe owner-accesstoken
fp -> fd: POST /TIHealthcareService {providedBy.id=telematikID}
activate fd
fd - -> fp: HTTP 200 OK (Result Body json)
fp - -> cl: HTTP 200 OK (Result Body json)
deactivate fd
deactivate fp
deactivate cl
@enduml

@startuml

skinparam dpi 100
skinparam WrapWidth 200
skinparam monochrome true

actor o as "Org-Admin\noder LE"
participant cl as "Org-Admin-Client\noder\nTI-Messenger-Client"
participant aa as "Authenticator App\ndes IDP"
participant au as "Auth-Service"
participant fp as "FHIR-Proxy"
participant idp as "Identity Provider"
participant fd as "FHIR-Directory"
participant rd as "TI-Messenger\nRegistrierungsdienst"
o -> cl: möchte seinen FHIR-Eintrag\nändern
activate cl
cl -> cl: prüfe ob noch gültiges owner-accesstoken\nfür Schreibzugriff vom Auth-Service vorliegt
alt kein gültiges owner-accesstoken für Schreibzugriff vorhanden
alt Org-Admin
cl -> rd: POST /regservice/user/{userId}/request_token
activate rd
rd - -> cl: HTTP 200 OK, Result body {"access_token": "RegService-OpenID-Token=id_token"}
deactivate rd
cl -> au: GET /owner-authenticate... ((Auth Header mit RegService-OpenID-Token))
activate au
au -> au: verify RegService-OpenID-Token (telematikID,...)
else LE mit HBA und TI-Messenger Client
cl -> au: GET /owner-authenticate
au -> au: Erzeuge PKCE Code für verifier und challenge
au - -> cl: Redirect (302) to IDP Authorization Endpoint
cl -> aa: Deeplink authenticator://...
activate aa

aa -> idp: GET {auth_endpoint}
activate idp
idp - -> aa: challenge
aa -> aa: sign challenge
aa-> idp: signed_challenge
idp - -> aa: Redirect (302) {auth_code,..)
aa - -> cl: {client_callback_uri} {auth_code}
deactivate aa

cl -> au: GET /signin-gematik-idp-dienst with {auth_code}
au -> idp: POST /tokenEndpoint {auth_code, verifier}
idp - -> au: Response {id_token}

deactivate idp
end
au -> au: erzeuge owner-accesstoken
au - -> cl: HTTP 200 OK, Result body {"access_token"="owner-accesstoken"}
deactivate au
end
cl -> fp: POST /owner/TIHealthcareService (Authorization Bearer owner-accesstoken) {providedBy.id=telematikID}
activate fp
fp -> fp: prüfe owner-accesstoken
fp -> fd: POST /TIHealthcareService {providedBy.id=telematikID}
activate fd
fd - -> fp: HTTP 200 OK (Result Body json)
fp - -> cl: HTTP 200 OK (Result Body json)
deactivate fd
deactivate fp
deactivate cl
@enduml

PlantUML version 1.2022.13(Sat Nov 19 13:22:17 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>