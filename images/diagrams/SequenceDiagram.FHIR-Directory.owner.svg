<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1391.6667px" preserveAspectRatio="none" style="width:1776px;height:1391px;background:#FFFFFF;" version="1.1" viewBox="0 0 1776 1391" width="1776.0417px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="1122.2087" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="250.5208" y="149.8535"/><rect fill="#FFFFFF" height="74.235" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="564.0625" y="707.3486"/><rect fill="#FFFFFF" height="748.6735" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="769.2708" y="350.8219"/><rect fill="#FFFFFF" height="134.9284" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1106.7708" y="1137.1338"/><rect fill="#FFFFFF" height="121.3867" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1298.4375" y="781.5837"/><rect fill="#FFFFFF" height="60.6934" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1510.9375" y="1211.3688"/><rect fill="#FFFFFF" height="30.3467" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1661.9792" y="290.1286"/><rect fill="#FFFFFF" height="46.11" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1661.9792" y="475.1302"/><rect fill="none" height="882.6986" style="stroke:#000000;stroke-width:1.5625;" width="1615.1042" x="155.2083" y="225.1302"/><rect fill="none" height="154.6549" style="stroke:#000000;stroke-width:1.5625;" width="1594.2708" x="165.625" y="250.2686"/><rect fill="none" height="153.9551" style="stroke:#000000;stroke-width:1.5625;" width="1048.4375" x="711.4583" y="419.5068"/><rect fill="none" height="107.7067" style="stroke:#000000;stroke-width:1.5625;" width="400.5208" x="711.4583" y="918.5954"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="45.8333" x2="45.8333" y1="101.6602" y2="1290.8122"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="255.2083" x2="255.2083" y1="101.6602" y2="1290.8122"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="569.2708" x2="569.2708" y1="101.6602" y2="1290.8122"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="773.9583" x2="773.9583" y1="101.6602" y2="1290.8122"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="1111.4583" x2="1111.4583" y1="101.6602" y2="1290.8122"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="1303.6458" x2="1303.6458" y1="101.6602" y2="1290.8122"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="1516.1458" x2="1516.1458" y1="101.6602" y2="1290.8122"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="1667.1875" x2="1667.1875" y1="101.6602" y2="1290.8122"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="76.0417" x="5.2083" y="81.2449">Org-Admin</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="54.1667" x="16.1458" y="98.2208">oder LE</text><ellipse cx="46.3542" cy="14.0625" fill="#E3E3E3" rx="8.3333" ry="8.3333" style="stroke:#181818;stroke-width:0.5208333333333334;"/><path d="M46.3542,22.3958 L46.3542,50.5208 M32.8125,30.7292 L59.8958,30.7292 M46.3542,50.5208 L32.8125,66.1458 M46.3542,50.5208 L59.8958,66.1458 " fill="none" style="stroke:#181818;stroke-width:0.5208333333333334;"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="76.0417" x="5.2083" y="1303.3071">Org-Admin</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="54.1667" x="16.1458" y="1320.283">oder LE</text><ellipse cx="46.3542" cy="1332.5765" fill="#E3E3E3" rx="8.3333" ry="8.3333" style="stroke:#181818;stroke-width:0.5208333333333334;"/><path d="M46.3542,1340.9098 L46.3542,1369.0348 M32.8125,1349.2432 L59.8958,1349.2432 M46.3542,1369.0348 L32.8125,1384.6598 M46.3542,1369.0348 L59.8958,1384.6598 " fill="none" style="stroke:#181818;stroke-width:0.5208333333333334;"/><rect fill="#E3E3E3" height="65.5111" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="159.375" x="176.0417" y="35.1074"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="121.875" x="194.7917" y="55.9357">Org-Admin-Client</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="33.3333" x="239.0625" y="72.9116">oder</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="144.7917" x="183.3333" y="89.8875">TI-Messenger-Client</text><rect fill="#E3E3E3" height="65.5111" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="159.375" x="176.0417" y="1289.7705"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="121.875" x="194.7917" y="1310.5988">Org-Admin-Client</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="33.3333" x="239.0625" y="1327.5747">oder</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="144.7917" x="183.3333" y="1344.5506">TI-Messenger-Client</text><rect fill="#E3E3E3" height="48.5352" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="143.75" x="497.3958" y="52.0833"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="129.1667" x="504.6875" y="72.9116">Authenticator App</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="55.2083" x="541.6667" y="89.8875">des IDP</text><rect fill="#E3E3E3" height="48.5352" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="143.75" x="497.3958" y="1289.7705"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="129.1667" x="504.6875" y="1310.5988">Authenticator App</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="55.2083" x="541.6667" y="1327.5747">des IDP</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="105.2083" x="721.875" y="69.0592"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="90.625" x="729.1667" y="89.8875">Auth-Service</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="105.2083" x="721.875" y="1289.7705"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="90.625" x="729.1667" y="1310.5988">Auth-Service</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="90.625" x="1066.6667" y="69.0592"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="76.0417" x="1073.9583" y="89.8875">FHIR-Proxy</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="90.625" x="1066.6667" y="1289.7705"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="76.0417" x="1073.9583" y="1310.5988">FHIR-Proxy</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="129.1667" x="1239.0625" y="69.0592"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="114.5833" x="1246.3542" y="89.8875">Identity Provider</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="129.1667" x="1239.0625" y="1289.7705"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="114.5833" x="1246.3542" y="1310.5988">Identity Provider</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="116.6667" x="1457.8125" y="69.0592"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="102.0833" x="1465.1042" y="89.8875">FHIR-Directory</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="116.6667" x="1457.8125" y="1289.7705"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="102.0833" x="1465.1042" y="1310.5988">FHIR-Directory</text><rect fill="#E3E3E3" height="48.5352" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="164.5833" x="1584.8958" y="52.0833"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="98.9583" x="1617.7083" y="72.9116">TI-Messenger</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="150" x="1592.1875" y="89.8875">Registrierungsdienst</text><rect fill="#E3E3E3" height="48.5352" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="164.5833" x="1584.8958" y="1289.7705"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="98.9583" x="1617.7083" y="1310.5988">TI-Messenger</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="150" x="1592.1875" y="1327.5747">Registrierungsdienst</text><rect fill="#FFFFFF" height="1122.2087" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="250.5208" y="149.8535"/><rect fill="#FFFFFF" height="74.235" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="564.0625" y="707.3486"/><rect fill="#FFFFFF" height="748.6735" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="769.2708" y="350.8219"/><rect fill="#FFFFFF" height="134.9284" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1106.7708" y="1137.1338"/><rect fill="#FFFFFF" height="121.3867" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1298.4375" y="781.5837"/><rect fill="#FFFFFF" height="60.6934" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1510.9375" y="1211.3688"/><rect fill="#FFFFFF" height="30.3467" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1661.9792" y="290.1286"/><rect fill="#FFFFFF" height="46.11" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1661.9792" y="475.1302"/><polygon fill="#181818" points="238.0208,145.6868,248.4375,149.8535,238.0208,154.0202,242.1875,149.8535" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="46.3542" x2="244.2708" y1="149.8535" y2="149.8535"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="184.375" x="53.6458" y="128.8132">möchte seinen FHIR-Eintrag</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="46.875" x="53.6458" y="144.5765">ändern</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="260.9375" x2="304.6875" y1="195.9635" y2="195.9635"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="304.6875" x2="304.6875" y1="195.9635" y2="209.5052"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="261.9792" x2="304.6875" y1="209.5052" y2="209.5052"/><polygon fill="#181818" points="272.3958,205.3385,261.9792,209.5052,272.3958,213.6719,268.2292,209.5052" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="280.2083" x="268.2292" y="174.9232">prüfe ob noch gültiges owner-accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="288.5417" x="268.2292" y="190.6865">für Schreibzugriff vom Auth-Service vorliegt</text><path d="M155.2083,225.1302 L221.875,225.1302 L221.875,232.5602 L211.4583,242.9769 L155.2083,242.9769 L155.2083,225.1302 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5625;"/><rect fill="none" height="882.6986" style="stroke:#000000;stroke-width:1.5625;" width="1615.1042" x="155.2083" y="225.1302"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" font-weight="bold" lengthAdjust="spacing" textLength="19.7917" x="170.8333" y="238.7416">alt</text><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="427.0833" x="237.5" y="237.8494">[kein gültiges owner-accesstoken für Schreibzugriff vorhanden]</text><path d="M165.625,250.2686 L232.2917,250.2686 L232.2917,257.6986 L221.875,268.1152 L165.625,268.1152 L165.625,250.2686 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5625;"/><rect fill="none" height="154.6549" style="stroke:#000000;stroke-width:1.5625;" width="1594.2708" x="165.625" y="250.2686"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" font-weight="bold" lengthAdjust="spacing" textLength="19.7917" x="181.25" y="263.8799">alt</text><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="125" x="247.9167" y="262.9878">[Org-Admin-Client]</text><polygon fill="#181818" points="1649.4792,285.9619,1659.8958,290.1286,1649.4792,294.2952,1653.6458,290.1286" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="260.9375" x2="1655.7292" y1="290.1286" y2="290.1286"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="307.2917" x="268.2292" y="284.8516">POST /regservice/user/{userId}/request_token</text><polygon fill="#181818" points="272.3958,316.3086,261.9792,320.4753,272.3958,324.6419,268.2292,320.4753" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="266.1458" x2="1666.1458" y1="320.4753" y2="320.4753"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="1114.5833" x="278.6458" y="315.1983">HTTP 200 OK, Result body {"access_token": "RegService-OpenID-Token",..., "reg_server_url": "https://regserver.example.com/openid/userinfo/"; "userid": "admin-userid"}</text><polygon fill="#181818" points="756.7708,346.6553,767.1875,350.8219,756.7708,354.9886,760.9375,350.8219" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="260.9375" x2="763.0208" y1="350.8219" y2="350.8219"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="488.5417" x="268.2292" y="345.5449">GET /owner-authenticate... ((Auth Header mit RegService-OpenID-Token))</text><line style="stroke:#000000;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="165.625" x2="1759.8958" y1="360.1969" y2="360.1969"/><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="145.8333" x="170.8333" y="370.8328">[TI-Messenger-Client]</text><polygon fill="#181818" points="756.7708,392.4235,767.1875,396.5902,756.7708,400.7568,760.9375,396.5902" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="260.9375" x2="763.0208" y1="396.5902" y2="396.5902"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="163.5417" x="268.2292" y="391.3132">GET /owner-authenticate</text><path d="M711.4583,419.5068 L778.125,419.5068 L778.125,426.9368 L767.7083,437.3535 L711.4583,437.3535 L711.4583,419.5068 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5625;"/><rect fill="none" height="153.9551" style="stroke:#000000;stroke-width:1.5625;" width="1048.4375" x="711.4583" y="419.5068"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" font-weight="bold" lengthAdjust="spacing" textLength="19.7917" x="727.0833" y="433.1182">alt</text><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="184.375" x="793.75" y="432.2261">[RegService-OpenID-Token]</text><polygon fill="#181818" points="1649.4792,470.9635,1659.8958,475.1302,1649.4792,479.2969,1653.6458,475.1302" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="779.6875" x2="1655.7292" y1="475.1302" y2="475.1302"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="147.9167" x="786.9792" y="454.0899">GET /openid/userinfo/?</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="280.2083" x="786.9792" y="469.8532">access_token=RegService-OpenID-Token)</text><polygon fill="#181818" points="791.1458,517.0736,780.7292,521.2402,791.1458,525.4069,786.9792,521.2402" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="784.8958" x2="1666.1458" y1="521.2402" y2="521.2402"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="85.4167" x="797.3958" y="500.1999">HTTP 200 OK</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="375" x="797.3958" y="515.9632">(Result Body userid des Org-Admin auf dem Reg-Server)</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="779.6875" x2="823.4375" y1="551.5869" y2="551.5869"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="823.4375" x2="823.4375" y1="551.5869" y2="565.1286"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="780.7292" x2="823.4375" y1="565.1286" y2="565.1286"/><polygon fill="#181818" points="791.1458,560.9619,780.7292,565.1286,791.1458,569.2952,786.9792,565.1286" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="80.2083" x="786.9792" y="546.3099">verify userid</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="779.6875" x2="823.4375" y1="602.7669" y2="602.7669"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="823.4375" x2="823.4375" y1="602.7669" y2="616.3086"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="780.7292" x2="823.4375" y1="616.3086" y2="616.3086"/><polygon fill="#181818" points="791.1458,612.1419,780.7292,616.3086,791.1458,620.4753,786.9792,616.3086" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="298.9583" x="786.9792" y="597.4899">Erzeuge PKCE Code für verifier und challenge</text><polygon fill="#181818" points="272.3958,642.4886,261.9792,646.6553,272.3958,650.8219,268.2292,646.6553" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="266.1458" x2="768.2292" y1="646.6553" y2="646.6553"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="253.125" x="278.6458" y="641.3783">Redirect to IDP Authorization Endpoint</text><polygon fill="#181818" points="1291.1458,672.8353,1301.5625,677.002,1291.1458,681.1686,1295.3125,677.002" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="260.9375" x2="1297.3958" y1="677.002" y2="677.002"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="96.875" x="268.2292" y="671.725">GET /authorize</text><polygon fill="#181818" points="272.3958,703.182,261.9792,707.3486,272.3958,711.5153,268.2292,707.3486" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="266.1458" x2="1302.6042" y1="707.3486" y2="707.3486"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="164.5833" x="278.6458" y="702.0716">Authentication challenge</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="574.4792" x2="618.2292" y1="737.6953" y2="737.6953"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="618.2292" x2="618.2292" y1="737.6953" y2="751.237"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="575.5208" x2="618.2292" y1="751.237" y2="751.237"/><polygon fill="#181818" points="585.9375,747.0703,575.5208,751.237,585.9375,755.4036,581.7708,751.237" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="96.875" x="581.7708" y="732.4183">Authentication</text><polygon fill="#181818" points="1285.9375,777.417,1296.3542,781.5837,1285.9375,785.7503,1290.1042,781.5837" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="569.2708" x2="1292.1875" y1="781.5837" y2="781.5837"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="230.2083" x="576.5625" y="776.3067">Authentication challenge response</text><polygon fill="#181818" points="272.3958,807.7637,261.9792,811.9303,272.3958,816.097,268.2292,811.9303" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="266.1458" x2="1297.3958" y1="811.9303" y2="811.9303"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="316.6667" x="278.6458" y="806.6533">Authorization Response with Authorization code</text><polygon fill="#181818" points="756.7708,838.1104,767.1875,842.277,756.7708,846.4437,760.9375,842.277" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="260.9375" x2="763.0208" y1="842.277" y2="842.277"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="322.9167" x="268.2292" y="837">GET /owner-authenticate with Authorization code</text><polygon fill="#181818" points="1285.9375,868.457,1296.3542,872.6237,1285.9375,876.7904,1290.1042,872.6237" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="779.6875" x2="1292.1875" y1="872.6237" y2="872.6237"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="284.375" x="786.9792" y="867.3467">POST /tokenEndpoint {authorization code}</text><polygon fill="#181818" points="791.1458,898.8037,780.7292,902.9704,791.1458,907.137,786.9792,902.9704" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="784.8958" x2="1302.6042" y1="902.9704" y2="902.9704"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="141.6667" x="797.3958" y="897.6934">Response {id_token}</text><path d="M711.4583,918.5954 L778.125,918.5954 L778.125,926.0254 L767.7083,936.4421 L711.4583,936.4421 L711.4583,918.5954 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5625;"/><rect fill="none" height="107.7067" style="stroke:#000000;stroke-width:1.5625;" width="400.5208" x="711.4583" y="918.5954"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" font-weight="bold" lengthAdjust="spacing" textLength="19.7917" x="727.0833" y="932.2067">alt</text><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="184.375" x="793.75" y="931.3146">[RegService-OpenID-Token]</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="779.6875" x2="823.4375" y1="958.4554" y2="958.4554"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="823.4375" x2="823.4375" y1="958.4554" y2="971.9971"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="780.7292" x2="823.4375" y1="971.9971" y2="971.9971"/><polygon fill="#181818" points="791.1458,967.8304,780.7292,971.9971,791.1458,976.1637,786.9792,971.9971" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="312.5" x="786.9792" y="953.1784">Prüfe idtoken (professionOID for Organization?)</text><line style="stroke:#000000;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="711.4583" x2="1111.9792" y1="981.3721" y2="981.3721"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="779.6875" x2="823.4375" y1="1004.4271" y2="1004.4271"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="823.4375" x2="823.4375" y1="1004.4271" y2="1017.9688"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="780.7292" x2="823.4375" y1="1017.9688" y2="1017.9688"/><polygon fill="#181818" points="791.1458,1013.8021,780.7292,1017.9688,791.1458,1022.1354,786.9792,1017.9688" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="304.1667" x="786.9792" y="999.1501">Prüfe idtoken (professionOID for Practitioner?)</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="779.6875" x2="823.4375" y1="1055.6071" y2="1055.6071"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="823.4375" x2="823.4375" y1="1055.6071" y2="1069.1488"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="780.7292" x2="823.4375" y1="1069.1488" y2="1069.1488"/><polygon fill="#181818" points="791.1458,1064.9821,780.7292,1069.1488,791.1458,1073.3154,786.9792,1069.1488" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="186.4583" x="786.9792" y="1050.3301">erzeuge owner-accesstoken</text><polygon fill="#181818" points="272.3958,1095.3288,261.9792,1099.4954,272.3958,1103.6621,268.2292,1099.4954" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="266.1458" x2="773.4375" y1="1099.4954" y2="1099.4954"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="442.7083" x="278.6458" y="1094.2184">HTTP 200 OK, Result body {"access_token"="owner-accesstoken"}</text><polygon fill="#181818" points="1094.2708,1132.9671,1104.6875,1137.1338,1094.2708,1141.3005,1098.4375,1137.1338" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="260.9375" x2="1100.5208" y1="1137.1338" y2="1137.1338"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="702.0833" x="268.2292" y="1131.8568">POST /owner/TIHealthcareService (Authorization Bearer owner-accesstoken) {providedBy.id=telematikID}</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="1117.1875" x2="1160.9375" y1="1167.4805" y2="1167.4805"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="1160.9375" x2="1160.9375" y1="1167.4805" y2="1181.0221"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="1118.2292" x2="1160.9375" y1="1181.0221" y2="1181.0221"/><polygon fill="#181818" points="1128.6458,1176.8555,1118.2292,1181.0221,1128.6458,1185.1888,1124.4792,1181.0221" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="166.6667" x="1124.4792" y="1162.2035">prüfe owner-accesstoken</text><polygon fill="#181818" points="1498.4375,1207.2021,1508.8542,1211.3688,1498.4375,1215.5355,1502.6042,1211.3688" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="1117.1875" x2="1504.6875" y1="1211.3688" y2="1211.3688"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="373.9583" x="1124.4792" y="1206.0918">POST /TIHealthcareService {providedBy.id=telematikID}</text><polygon fill="#181818" points="1128.6458,1237.5488,1118.2292,1241.7155,1128.6458,1245.8822,1124.4792,1241.7155" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="1122.3958" x2="1509.8958" y1="1241.7155" y2="1241.7155"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="209.375" x="1134.8958" y="1236.4385">HTTP 200 OK (Result Body json)</text><polygon fill="#181818" points="267.1875,1267.8955,256.7708,1272.0622,267.1875,1276.2288,263.0208,1272.0622" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="260.9375" x2="1110.9375" y1="1272.0622" y2="1272.0622"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="209.375" x="273.4375" y="1266.7852">HTTP 200 OK (Result Body json)</text><!--MD5=[6e1afb935495f57457ada62325b5a250]
@startuml FHIR-Directory, Sequenzdiagram Änderung von eigenen -Einträgen
skinparam dpi 100
skinparam WrapWidth 200
skinparam monochrome true

'title "FHIR-Directory, Sequenzdiagram Änderung von eigenen Einträgen'
actor o as "Org-Admin\noder LE"
participant cl as "Org-Admin-Client\noder\nTI-Messenger-Client"
participant aa as "Authenticator App\ndes IDP"
participant au as "Auth-Service"
participant fp as "FHIR-Proxy"
participant idp as "Identity Provider"
participant fd as "FHIR-Directory"
participant rd as "TI-Messenger\nRegistrierungsdienst"
o -> cl: möchte seinen FHIR-Eintrag\nändern
activate cl
cl -> cl: prüfe ob noch gültiges owner-accesstoken\nfür Schreibzugriff vom Auth-Service vorliegt
alt kein gültiges owner-accesstoken für Schreibzugriff vorhanden
alt Org-Admin-Client
cl -> rd: POST /regservice/user/{userId}/request_token
activate rd
rd - -> cl: HTTP 200 OK, Result body {"access_token": "RegService-OpenID-Token",..., "reg_server_url": "https://regserver.example.com/openid/userinfo/"; "userid": "admin-userid"}
deactivate rd
cl -> au: GET /owner-authenticate... ((Auth Header mit RegService-OpenID-Token))
activate au
else TI-Messenger-Client
cl -> au: GET /owner-authenticate
end
alt RegService-OpenID-Token
au -> rd: GET /openid/userinfo/?\naccess_token=RegService-OpenID-Token)
activate rd
rd - -> au: HTTP 200 OK\n(Result Body userid des Org-Admin auf dem Reg-Server)
deactivate rd
au -> au: verify userid
end
au -> au: Erzeuge PKCE Code für verifier und challenge
au - -> cl: Redirect to IDP Authorization Endpoint
cl -> idp: GET /authorize
idp - -> cl: Authentication challenge
activate aa
aa -> aa: Authentication
aa - -> idp: Authentication challenge response
deactivate aa
activate idp
idp - -> cl: Authorization Response with Authorization code
cl -> au: GET /owner-authenticate with Authorization code
au -> idp: POST /tokenEndpoint {authorization code}
idp - -> au: Response {id_token}

deactivate idp
alt RegService-OpenID-Token
au -> au: Prüfe idtoken (professionOID for Organization?)
else
au -> au: Prüfe idtoken (professionOID for Practitioner?)
end
au -> au: erzeuge owner-accesstoken
au - -> cl: HTTP 200 OK, Result body {"access_token"="owner-accesstoken"}
deactivate au
end
cl -> fp: POST /owner/TIHealthcareService (Authorization Bearer owner-accesstoken) {providedBy.id=telematikID}
activate fp
fp -> fp: prüfe owner-accesstoken
fp -> fd: POST /TIHealthcareService {providedBy.id=telematikID}
activate fd
fd - -> fp: HTTP 200 OK (Result Body json)
fp - -> cl: HTTP 200 OK (Result Body json)
deactivate fd
deactivate fp
deactivate cl
@enduml

@startuml FHIR-Directory, Sequenzdiagram Änderung von eigenen -Einträgen
skinparam dpi 100
skinparam WrapWidth 200
skinparam monochrome true

actor o as "Org-Admin\noder LE"
participant cl as "Org-Admin-Client\noder\nTI-Messenger-Client"
participant aa as "Authenticator App\ndes IDP"
participant au as "Auth-Service"
participant fp as "FHIR-Proxy"
participant idp as "Identity Provider"
participant fd as "FHIR-Directory"
participant rd as "TI-Messenger\nRegistrierungsdienst"
o -> cl: möchte seinen FHIR-Eintrag\nändern
activate cl
cl -> cl: prüfe ob noch gültiges owner-accesstoken\nfür Schreibzugriff vom Auth-Service vorliegt
alt kein gültiges owner-accesstoken für Schreibzugriff vorhanden
alt Org-Admin-Client
cl -> rd: POST /regservice/user/{userId}/request_token
activate rd
rd - -> cl: HTTP 200 OK, Result body {"access_token": "RegService-OpenID-Token",..., "reg_server_url": "https://regserver.example.com/openid/userinfo/"; "userid": "admin-userid"}
deactivate rd
cl -> au: GET /owner-authenticate... ((Auth Header mit RegService-OpenID-Token))
activate au
else TI-Messenger-Client
cl -> au: GET /owner-authenticate
end
alt RegService-OpenID-Token
au -> rd: GET /openid/userinfo/?\naccess_token=RegService-OpenID-Token)
activate rd
rd - -> au: HTTP 200 OK\n(Result Body userid des Org-Admin auf dem Reg-Server)
deactivate rd
au -> au: verify userid
end
au -> au: Erzeuge PKCE Code für verifier und challenge
au - -> cl: Redirect to IDP Authorization Endpoint
cl -> idp: GET /authorize
idp - -> cl: Authentication challenge
activate aa
aa -> aa: Authentication
aa - -> idp: Authentication challenge response
deactivate aa
activate idp
idp - -> cl: Authorization Response with Authorization code
cl -> au: GET /owner-authenticate with Authorization code
au -> idp: POST /tokenEndpoint {authorization code}
idp - -> au: Response {id_token}

deactivate idp
alt RegService-OpenID-Token
au -> au: Prüfe idtoken (professionOID for Organization?)
else
au -> au: Prüfe idtoken (professionOID for Practitioner?)
end
au -> au: erzeuge owner-accesstoken
au - -> cl: HTTP 200 OK, Result body {"access_token"="owner-accesstoken"}
deactivate au
end
cl -> fp: POST /owner/TIHealthcareService (Authorization Bearer owner-accesstoken) {providedBy.id=telematikID}
activate fp
fp -> fp: prüfe owner-accesstoken
fp -> fd: POST /TIHealthcareService {providedBy.id=telematikID}
activate fd
fd - -> fp: HTTP 200 OK (Result Body json)
fp - -> cl: HTTP 200 OK (Result Body json)
deactivate fd
deactivate fp
deactivate cl
@enduml

PlantUML version 1.2022.7(Mon Aug 22 17:01:30 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>