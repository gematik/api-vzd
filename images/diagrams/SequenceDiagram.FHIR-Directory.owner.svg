<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1144.7917px" preserveAspectRatio="none" style="width:1867px;height:1144px;background:#FFFFFF;" version="1.1" viewBox="0 0 1867 1144" width="1867.7083px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="875.2686" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="250.5208" y="149.8535"/><rect fill="#FFFFFF" height="74.235" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="564.0625" y="575.4069"/><rect fill="#FFFFFF" height="501.7334" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="769.2708" y="350.8219"/><rect fill="#FFFFFF" height="134.9284" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1198.4375" y="890.1937"/><rect fill="#FFFFFF" height="121.3867" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1390.1042" y="649.6419"/><rect fill="#FFFFFF" height="60.6934" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1602.6042" y="964.4287"/><rect fill="#FFFFFF" height="30.3467" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1753.6458" y="290.1286"/><rect fill="none" height="635.7585" style="stroke:#000000;stroke-width:1.5625;" width="1706.7708" x="155.2083" y="225.1302"/><rect fill="none" height="529.0934" style="stroke:#000000;stroke-width:1.5625;" width="1685.9375" x="165.625" y="250.2686"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="45.8333" x2="45.8333" y1="101.6602" y2="1043.8721"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="255.2083" x2="255.2083" y1="101.6602" y2="1043.8721"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="569.2708" x2="569.2708" y1="101.6602" y2="1043.8721"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="773.9583" x2="773.9583" y1="101.6602" y2="1043.8721"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="1203.125" x2="1203.125" y1="101.6602" y2="1043.8721"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="1395.3125" x2="1395.3125" y1="101.6602" y2="1043.8721"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="1607.8125" x2="1607.8125" y1="101.6602" y2="1043.8721"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="1758.8542" x2="1758.8542" y1="101.6602" y2="1043.8721"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="76.0417" x="5.2083" y="81.2449">Org-Admin</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="54.1667" x="16.1458" y="98.2208">oder LE</text><ellipse cx="46.3542" cy="14.0625" fill="#E3E3E3" rx="8.3333" ry="8.3333" style="stroke:#181818;stroke-width:0.5208333333333334;"/><path d="M46.3542,22.3958 L46.3542,50.5208 M32.8125,30.7292 L59.8958,30.7292 M46.3542,50.5208 L32.8125,66.1458 M46.3542,50.5208 L59.8958,66.1458 " fill="none" style="stroke:#181818;stroke-width:0.5208333333333334;"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="76.0417" x="5.2083" y="1056.367">Org-Admin</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="54.1667" x="16.1458" y="1073.3429">oder LE</text><ellipse cx="46.3542" cy="1085.6364" fill="#E3E3E3" rx="8.3333" ry="8.3333" style="stroke:#181818;stroke-width:0.5208333333333334;"/><path d="M46.3542,1093.9697 L46.3542,1122.0947 M32.8125,1102.3031 L59.8958,1102.3031 M46.3542,1122.0947 L32.8125,1137.7197 M46.3542,1122.0947 L59.8958,1137.7197 " fill="none" style="stroke:#181818;stroke-width:0.5208333333333334;"/><rect fill="#E3E3E3" height="65.5111" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="159.375" x="176.0417" y="35.1074"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="121.875" x="194.7917" y="55.9357">Org-Admin-Client</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="33.3333" x="239.0625" y="72.9116">oder</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="144.7917" x="183.3333" y="89.8875">TI-Messenger-Client</text><rect fill="#E3E3E3" height="65.5111" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="159.375" x="176.0417" y="1042.8304"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="121.875" x="194.7917" y="1063.6587">Org-Admin-Client</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="33.3333" x="239.0625" y="1080.6346">oder</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="144.7917" x="183.3333" y="1097.6105">TI-Messenger-Client</text><rect fill="#E3E3E3" height="48.5352" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="143.75" x="497.3958" y="52.0833"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="129.1667" x="504.6875" y="72.9116">Authenticator App</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="55.2083" x="541.6667" y="89.8875">des IDP</text><rect fill="#E3E3E3" height="48.5352" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="143.75" x="497.3958" y="1042.8304"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="129.1667" x="504.6875" y="1063.6587">Authenticator App</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="55.2083" x="541.6667" y="1080.6346">des IDP</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="105.2083" x="721.875" y="69.0592"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="90.625" x="729.1667" y="89.8875">Auth-Service</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="105.2083" x="721.875" y="1042.8304"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="90.625" x="729.1667" y="1063.6587">Auth-Service</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="90.625" x="1158.3333" y="69.0592"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="76.0417" x="1165.625" y="89.8875">FHIR-Proxy</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="90.625" x="1158.3333" y="1042.8304"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="76.0417" x="1165.625" y="1063.6587">FHIR-Proxy</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="129.1667" x="1330.7292" y="69.0592"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="114.5833" x="1338.0208" y="89.8875">Identity Provider</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="129.1667" x="1330.7292" y="1042.8304"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="114.5833" x="1338.0208" y="1063.6587">Identity Provider</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="116.6667" x="1549.4792" y="69.0592"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="102.0833" x="1556.7708" y="89.8875">FHIR-Directory</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="116.6667" x="1549.4792" y="1042.8304"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="102.0833" x="1556.7708" y="1063.6587">FHIR-Directory</text><rect fill="#E3E3E3" height="48.5352" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="164.5833" x="1676.5625" y="52.0833"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="98.9583" x="1709.375" y="72.9116">TI-Messenger</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="150" x="1683.8542" y="89.8875">Registrierungsdienst</text><rect fill="#E3E3E3" height="48.5352" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="164.5833" x="1676.5625" y="1042.8304"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="98.9583" x="1709.375" y="1063.6587">TI-Messenger</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="150" x="1683.8542" y="1080.6346">Registrierungsdienst</text><rect fill="#FFFFFF" height="875.2686" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="250.5208" y="149.8535"/><rect fill="#FFFFFF" height="74.235" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="564.0625" y="575.4069"/><rect fill="#FFFFFF" height="501.7334" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="769.2708" y="350.8219"/><rect fill="#FFFFFF" height="134.9284" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1198.4375" y="890.1937"/><rect fill="#FFFFFF" height="121.3867" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1390.1042" y="649.6419"/><rect fill="#FFFFFF" height="60.6934" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1602.6042" y="964.4287"/><rect fill="#FFFFFF" height="30.3467" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1753.6458" y="290.1286"/><polygon fill="#181818" points="238.0208,145.6868,248.4375,149.8535,238.0208,154.0202,242.1875,149.8535" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="46.3542" x2="244.2708" y1="149.8535" y2="149.8535"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="184.375" x="53.6458" y="128.8132">möchte seinen FHIR-Eintrag</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="46.875" x="53.6458" y="144.5765">ändern</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="260.9375" x2="304.6875" y1="195.9635" y2="195.9635"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="304.6875" x2="304.6875" y1="195.9635" y2="209.5052"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="261.9792" x2="304.6875" y1="209.5052" y2="209.5052"/><polygon fill="#181818" points="272.3958,205.3385,261.9792,209.5052,272.3958,213.6719,268.2292,209.5052" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="280.2083" x="268.2292" y="174.9232">prüfe ob noch gültiges owner-accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="288.5417" x="268.2292" y="190.6865">für Schreibzugriff vom Auth-Service vorliegt</text><path d="M155.2083,225.1302 L221.875,225.1302 L221.875,232.5602 L211.4583,242.9769 L155.2083,242.9769 L155.2083,225.1302 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5625;"/><rect fill="none" height="635.7585" style="stroke:#000000;stroke-width:1.5625;" width="1706.7708" x="155.2083" y="225.1302"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" font-weight="bold" lengthAdjust="spacing" textLength="19.7917" x="170.8333" y="238.7416">alt</text><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="427.0833" x="237.5" y="237.8494">[kein gültiges owner-accesstoken für Schreibzugriff vorhanden]</text><path d="M165.625,250.2686 L232.2917,250.2686 L232.2917,257.6986 L221.875,268.1152 L165.625,268.1152 L165.625,250.2686 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5625;"/><rect fill="none" height="529.0934" style="stroke:#000000;stroke-width:1.5625;" width="1685.9375" x="165.625" y="250.2686"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" font-weight="bold" lengthAdjust="spacing" textLength="19.7917" x="181.25" y="263.8799">alt</text><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="80.2083" x="247.9167" y="262.9878">[Org-Admin]</text><polygon fill="#181818" points="1741.1458,285.9619,1751.5625,290.1286,1741.1458,294.2952,1745.3125,290.1286" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="260.9375" x2="1747.3958" y1="290.1286" y2="290.1286"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="307.2917" x="268.2292" y="284.8516">POST /regservice/user/{userId}/request_token</text><polygon fill="#181818" points="272.3958,316.3086,261.9792,320.4753,272.3958,324.6419,268.2292,320.4753" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="266.1458" x2="1757.8125" y1="320.4753" y2="320.4753"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="552.0833" x="278.6458" y="315.1983">HTTP 200 OK, Result body {"access_token": "RegService-OpenID-Token=id_token"}</text><polygon fill="#181818" points="756.7708,346.6553,767.1875,350.8219,756.7708,354.9886,760.9375,350.8219" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="260.9375" x2="763.0208" y1="350.8219" y2="350.8219"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="488.5417" x="268.2292" y="345.5449">GET /owner-authenticate... ((Auth Header mit RegService-OpenID-Token))</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="779.6875" x2="823.4375" y1="381.1686" y2="381.1686"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="823.4375" x2="823.4375" y1="381.1686" y2="394.7103"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="780.7292" x2="823.4375" y1="394.7103" y2="394.7103"/><polygon fill="#181818" points="791.1458,390.5436,780.7292,394.7103,791.1458,398.877,786.9792,394.7103" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="404.1667" x="786.9792" y="375.8916">verify RegService-OpenID-Token (telematikID, professionOID)</text><line style="stroke:#000000;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="165.625" x2="1851.5625" y1="404.0853" y2="404.0853"/><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="250" x="170.8333" y="414.7212">[LE mit HBA und TI-Messenger Client]</text><polygon fill="#181818" points="756.7708,436.3118,767.1875,440.4785,756.7708,444.6452,760.9375,440.4785" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="260.9375" x2="763.0208" y1="440.4785" y2="440.4785"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="163.5417" x="268.2292" y="435.2015">GET /owner-authenticate</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="779.6875" x2="823.4375" y1="470.8252" y2="470.8252"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="823.4375" x2="823.4375" y1="470.8252" y2="484.3669"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="780.7292" x2="823.4375" y1="484.3669" y2="484.3669"/><polygon fill="#181818" points="791.1458,480.2002,780.7292,484.3669,791.1458,488.5335,786.9792,484.3669" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="298.9583" x="786.9792" y="465.5482">Erzeuge PKCE Code für verifier und challenge</text><polygon fill="#181818" points="272.3958,510.5469,261.9792,514.7135,272.3958,518.8802,268.2292,514.7135" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="266.1458" x2="768.2292" y1="514.7135" y2="514.7135"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="253.125" x="278.6458" y="509.4365">Redirect to IDP Authorization Endpoint</text><polygon fill="#181818" points="1382.8125,540.8936,1393.2292,545.0602,1382.8125,549.2269,1386.9792,545.0602" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="260.9375" x2="1389.0625" y1="545.0602" y2="545.0602"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="106.25" x="268.2292" y="539.7832">POST /authorize</text><polygon fill="#181818" points="272.3958,571.2402,261.9792,575.4069,272.3958,579.5736,268.2292,575.4069" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="266.1458" x2="1394.2708" y1="575.4069" y2="575.4069"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="164.5833" x="278.6458" y="570.1299">Authentication challenge</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="574.4792" x2="618.2292" y1="605.7536" y2="605.7536"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="618.2292" x2="618.2292" y1="605.7536" y2="619.2952"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="575.5208" x2="618.2292" y1="619.2952" y2="619.2952"/><polygon fill="#181818" points="585.9375,615.1286,575.5208,619.2952,585.9375,623.4619,581.7708,619.2952" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="96.875" x="581.7708" y="600.4766">Authentication</text><polygon fill="#181818" points="1377.6042,645.4753,1388.0208,649.6419,1377.6042,653.8086,1381.7708,649.6419" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="569.2708" x2="1383.8542" y1="649.6419" y2="649.6419"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="230.2083" x="576.5625" y="644.3649">Authentication challenge response</text><polygon fill="#181818" points="272.3958,675.8219,261.9792,679.9886,272.3958,684.1553,268.2292,679.9886" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="266.1458" x2="1389.0625" y1="679.9886" y2="679.9886"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="316.6667" x="278.6458" y="674.7116">Authorization Response with Authorization code</text><polygon fill="#181818" points="756.7708,706.1686,767.1875,710.3353,756.7708,714.502,760.9375,710.3353" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="260.9375" x2="763.0208" y1="710.3353" y2="710.3353"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="362.5" x="268.2292" y="705.0583">GET /signin-gematik-idp-dienst with Authorization code</text><polygon fill="#181818" points="1377.6042,736.5153,1388.0208,740.682,1377.6042,744.8486,1381.7708,740.682" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="779.6875" x2="1383.8542" y1="740.682" y2="740.682"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="284.375" x="786.9792" y="735.405">POST /tokenEndpoint {authorization code}</text><polygon fill="#181818" points="791.1458,766.862,780.7292,771.0286,791.1458,775.1953,786.9792,771.0286" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="784.8958" x2="1394.2708" y1="771.0286" y2="771.0286"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="141.6667" x="797.3958" y="765.7516">Response {id_token}</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="779.6875" x2="823.4375" y1="808.667" y2="808.667"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="823.4375" x2="823.4375" y1="808.667" y2="822.2087"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="780.7292" x2="823.4375" y1="822.2087" y2="822.2087"/><polygon fill="#181818" points="791.1458,818.042,780.7292,822.2087,791.1458,826.3753,786.9792,822.2087" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="186.4583" x="786.9792" y="803.39">erzeuge owner-accesstoken</text><polygon fill="#181818" points="272.3958,848.3887,261.9792,852.5553,272.3958,856.722,268.2292,852.5553" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="266.1458" x2="773.4375" y1="852.5553" y2="852.5553"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="442.7083" x="278.6458" y="847.2783">HTTP 200 OK, Result body {"access_token"="owner-accesstoken"}</text><polygon fill="#181818" points="1185.9375,886.027,1196.3542,890.1937,1185.9375,894.3604,1190.1042,890.1937" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="260.9375" x2="1192.1875" y1="890.1937" y2="890.1937"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="702.0833" x="268.2292" y="884.9167">POST /owner/TIHealthcareService (Authorization Bearer owner-accesstoken) {providedBy.id=telematikID}</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="1208.8542" x2="1252.6042" y1="920.5404" y2="920.5404"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="1252.6042" x2="1252.6042" y1="920.5404" y2="934.082"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="1209.8958" x2="1252.6042" y1="934.082" y2="934.082"/><polygon fill="#181818" points="1220.3125,929.9154,1209.8958,934.082,1220.3125,938.2487,1216.1458,934.082" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="166.6667" x="1216.1458" y="915.2634">prüfe owner-accesstoken</text><polygon fill="#181818" points="1590.1042,960.262,1600.5208,964.4287,1590.1042,968.5954,1594.2708,964.4287" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="1208.8542" x2="1596.3542" y1="964.4287" y2="964.4287"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="373.9583" x="1216.1458" y="959.1517">POST /TIHealthcareService {providedBy.id=telematikID}</text><polygon fill="#181818" points="1220.3125,990.6087,1209.8958,994.7754,1220.3125,998.9421,1216.1458,994.7754" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="1214.0625" x2="1601.5625" y1="994.7754" y2="994.7754"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="209.375" x="1226.5625" y="989.4984">HTTP 200 OK (Result Body json)</text><polygon fill="#181818" points="267.1875,1020.9554,256.7708,1025.1221,267.1875,1029.2887,263.0208,1025.1221" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="260.9375" x2="1202.6042" y1="1025.1221" y2="1025.1221"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="209.375" x="273.4375" y="1019.8451">HTTP 200 OK (Result Body json)</text><!--MD5=[75f76e1ee2de3bb92551b173a148b072]
@startuml FHIR-Directory, Sequenzdiagram Änderung von eigenen -Einträgen
skinparam dpi 100
skinparam WrapWidth 200
skinparam monochrome true

'title "FHIR-Directory, Sequenzdiagram Änderung von eigenen Einträgen'
actor o as "Org-Admin\noder LE"
participant cl as "Org-Admin-Client\noder\nTI-Messenger-Client"
participant aa as "Authenticator App\ndes IDP"
participant au as "Auth-Service"
participant fp as "FHIR-Proxy"
participant idp as "Identity Provider"
participant fd as "FHIR-Directory"
participant rd as "TI-Messenger\nRegistrierungsdienst"
o -> cl: möchte seinen FHIR-Eintrag\nändern
activate cl
cl -> cl: prüfe ob noch gültiges owner-accesstoken\nfür Schreibzugriff vom Auth-Service vorliegt
alt kein gültiges owner-accesstoken für Schreibzugriff vorhanden
alt Org-Admin
cl -> rd: POST /regservice/user/{userId}/request_token
activate rd
rd - -> cl: HTTP 200 OK, Result body {"access_token": "RegService-OpenID-Token=id_token"}
deactivate rd
cl -> au: GET /owner-authenticate... ((Auth Header mit RegService-OpenID-Token))
activate au
au -> au: verify RegService-OpenID-Token (telematikID, professionOID)
else LE mit HBA und TI-Messenger Client
cl -> au: GET /owner-authenticate
au -> au: Erzeuge PKCE Code für verifier und challenge
au - -> cl: Redirect to IDP Authorization Endpoint
cl -> idp: POST /authorize
idp - -> cl: Authentication challenge
activate aa
aa -> aa: Authentication
aa - -> idp: Authentication challenge response
deactivate aa
activate idp
idp - -> cl: Authorization Response with Authorization code
cl -> au: GET /signin-gematik-idp-dienst with Authorization code
au -> idp: POST /tokenEndpoint {authorization code}
idp - -> au: Response {id_token}

deactivate idp
end
au -> au: erzeuge owner-accesstoken
au - -> cl: HTTP 200 OK, Result body {"access_token"="owner-accesstoken"}
deactivate au
end
cl -> fp: POST /owner/TIHealthcareService (Authorization Bearer owner-accesstoken) {providedBy.id=telematikID}
activate fp
fp -> fp: prüfe owner-accesstoken
fp -> fd: POST /TIHealthcareService {providedBy.id=telematikID}
activate fd
fd - -> fp: HTTP 200 OK (Result Body json)
fp - -> cl: HTTP 200 OK (Result Body json)
deactivate fd
deactivate fp
deactivate cl
@enduml

@startuml FHIR-Directory, Sequenzdiagram Änderung von eigenen -Einträgen
skinparam dpi 100
skinparam WrapWidth 200
skinparam monochrome true

actor o as "Org-Admin\noder LE"
participant cl as "Org-Admin-Client\noder\nTI-Messenger-Client"
participant aa as "Authenticator App\ndes IDP"
participant au as "Auth-Service"
participant fp as "FHIR-Proxy"
participant idp as "Identity Provider"
participant fd as "FHIR-Directory"
participant rd as "TI-Messenger\nRegistrierungsdienst"
o -> cl: möchte seinen FHIR-Eintrag\nändern
activate cl
cl -> cl: prüfe ob noch gültiges owner-accesstoken\nfür Schreibzugriff vom Auth-Service vorliegt
alt kein gültiges owner-accesstoken für Schreibzugriff vorhanden
alt Org-Admin
cl -> rd: POST /regservice/user/{userId}/request_token
activate rd
rd - -> cl: HTTP 200 OK, Result body {"access_token": "RegService-OpenID-Token=id_token"}
deactivate rd
cl -> au: GET /owner-authenticate... ((Auth Header mit RegService-OpenID-Token))
activate au
au -> au: verify RegService-OpenID-Token (telematikID, professionOID)
else LE mit HBA und TI-Messenger Client
cl -> au: GET /owner-authenticate
au -> au: Erzeuge PKCE Code für verifier und challenge
au - -> cl: Redirect to IDP Authorization Endpoint
cl -> idp: POST /authorize
idp - -> cl: Authentication challenge
activate aa
aa -> aa: Authentication
aa - -> idp: Authentication challenge response
deactivate aa
activate idp
idp - -> cl: Authorization Response with Authorization code
cl -> au: GET /signin-gematik-idp-dienst with Authorization code
au -> idp: POST /tokenEndpoint {authorization code}
idp - -> au: Response {id_token}

deactivate idp
end
au -> au: erzeuge owner-accesstoken
au - -> cl: HTTP 200 OK, Result body {"access_token"="owner-accesstoken"}
deactivate au
end
cl -> fp: POST /owner/TIHealthcareService (Authorization Bearer owner-accesstoken) {providedBy.id=telematikID}
activate fp
fp -> fp: prüfe owner-accesstoken
fp -> fd: POST /TIHealthcareService {providedBy.id=telematikID}
activate fd
fd - -> fp: HTTP 200 OK (Result Body json)
fp - -> cl: HTTP 200 OK (Result Body json)
deactivate fd
deactivate fp
deactivate cl
@enduml

PlantUML version 1.2022.13(Sat Nov 19 13:22:17 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>