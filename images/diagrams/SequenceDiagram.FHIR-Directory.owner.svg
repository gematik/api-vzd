<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1357.2917px" preserveAspectRatio="none" style="width:1761px;height:1357px;background:#FFFFFF;" version="1.1" viewBox="0 0 1761 1357" width="1761.4583px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="1122.2087" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="235.9375" y="132.8776"/><rect fill="#FFFFFF" height="74.235" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="549.4792" y="690.3727"/><rect fill="#FFFFFF" height="748.6735" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="754.6875" y="333.846"/><rect fill="#FFFFFF" height="134.9284" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1092.1875" y="1120.1579"/><rect fill="#FFFFFF" height="121.3867" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1283.8542" y="764.6077"/><rect fill="#FFFFFF" height="60.6934" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1496.3542" y="1194.3929"/><rect fill="#FFFFFF" height="30.3467" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1647.3958" y="273.1527"/><rect fill="#FFFFFF" height="46.11" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1647.3958" y="458.1543"/><rect height="882.6986" style="stroke:#000000;stroke-width:1.5625;fill:none;" width="1615.1042" x="140.625" y="208.1543"/><rect height="154.6549" style="stroke:#000000;stroke-width:1.5625;fill:none;" width="1594.2708" x="151.0417" y="233.2926"/><rect height="153.9551" style="stroke:#000000;stroke-width:1.5625;fill:none;" width="1048.4375" x="696.875" y="402.5309"/><rect height="107.7067" style="stroke:#000000;stroke-width:1.5625;fill:none;" width="400.5208" x="696.875" y="901.6195"/><line style="stroke:#181818;stroke-width:0.5208333333333334;fill:none;stroke-dasharray:5.0,5.0;" x1="31.25" x2="31.25" y1="84.6842" y2="1273.8363"/><line style="stroke:#181818;stroke-width:0.5208333333333334;fill:none;stroke-dasharray:5.0,5.0;" x1="240.625" x2="240.625" y1="84.6842" y2="1273.8363"/><line style="stroke:#181818;stroke-width:0.5208333333333334;fill:none;stroke-dasharray:5.0,5.0;" x1="554.6875" x2="554.6875" y1="84.6842" y2="1273.8363"/><line style="stroke:#181818;stroke-width:0.5208333333333334;fill:none;stroke-dasharray:5.0,5.0;" x1="759.375" x2="759.375" y1="84.6842" y2="1273.8363"/><line style="stroke:#181818;stroke-width:0.5208333333333334;fill:none;stroke-dasharray:5.0,5.0;" x1="1096.875" x2="1096.875" y1="84.6842" y2="1273.8363"/><line style="stroke:#181818;stroke-width:0.5208333333333334;fill:none;stroke-dasharray:5.0,5.0;" x1="1289.0625" x2="1289.0625" y1="84.6842" y2="1273.8363"/><line style="stroke:#181818;stroke-width:0.5208333333333334;fill:none;stroke-dasharray:5.0,5.0;" x1="1501.5625" x2="1501.5625" y1="84.6842" y2="1273.8363"/><line style="stroke:#181818;stroke-width:0.5208333333333334;fill:none;stroke-dasharray:5.0,5.0;" x1="1652.6042" x2="1652.6042" y1="84.6842" y2="1273.8363"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="46.875" x="5.2083" y="81.2449">Owner</text><ellipse cx="31.7708" cy="14.0625" fill="#E3E3E3" rx="8.3333" ry="8.3333" style="stroke:#181818;stroke-width:0.5208333333333334;"/><path d="M31.7708,22.3958 L31.7708,50.5208 M18.2292,30.7292 L45.3125,30.7292 M31.7708,50.5208 L18.2292,66.1458 M31.7708,50.5208 L45.3125,66.1458 " fill="none" style="stroke:#181818;stroke-width:0.5208333333333334;"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="46.875" x="5.2083" y="1286.3312">Owner</text><ellipse cx="31.7708" cy="1298.6247" fill="#E3E3E3" rx="8.3333" ry="8.3333" style="stroke:#181818;stroke-width:0.5208333333333334;"/><path d="M31.7708,1306.958 L31.7708,1335.083 M18.2292,1315.2913 L45.3125,1315.2913 M31.7708,1335.083 L18.2292,1350.708 M31.7708,1335.083 L45.3125,1350.708 " fill="none" style="stroke:#181818;stroke-width:0.5208333333333334;"/><rect fill="#E3E3E3" height="65.5111" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="159.375" x="161.4583" y="18.1315"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="121.875" x="180.2083" y="38.9598">Org-Admin-Client</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="33.3333" x="224.4792" y="55.9357">oder</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="144.7917" x="168.75" y="72.9116">TI-Messenger-Client</text><rect fill="#E3E3E3" height="65.5111" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="159.375" x="161.4583" y="1272.7946"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="121.875" x="180.2083" y="1293.6228">Org-Admin-Client</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="33.3333" x="224.4792" y="1310.5988">oder</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="144.7917" x="168.75" y="1327.5747">TI-Messenger-Client</text><rect fill="#E3E3E3" height="48.5352" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="143.75" x="482.8125" y="35.1074"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="129.1667" x="490.1042" y="55.9357">Authenticator App</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="55.2083" x="527.0833" y="72.9116">des IDP</text><rect fill="#E3E3E3" height="48.5352" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="143.75" x="482.8125" y="1272.7946"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="129.1667" x="490.1042" y="1293.6228">Authenticator App</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="55.2083" x="527.0833" y="1310.5988">des IDP</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="105.2083" x="707.2917" y="52.0833"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="90.625" x="714.5833" y="72.9116">Auth-Service</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="105.2083" x="707.2917" y="1272.7946"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="90.625" x="714.5833" y="1293.6228">Auth-Service</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="90.625" x="1052.0833" y="52.0833"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="76.0417" x="1059.375" y="72.9116">FHIR-Proxy</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="90.625" x="1052.0833" y="1272.7946"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="76.0417" x="1059.375" y="1293.6228">FHIR-Proxy</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="129.1667" x="1224.4792" y="52.0833"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="114.5833" x="1231.7708" y="72.9116">Identity Provider</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="129.1667" x="1224.4792" y="1272.7946"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="114.5833" x="1231.7708" y="1293.6228">Identity Provider</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="116.6667" x="1443.2292" y="52.0833"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="102.0833" x="1450.5208" y="72.9116">FHIR-Directory</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="116.6667" x="1443.2292" y="1272.7946"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="102.0833" x="1450.5208" y="1293.6228">FHIR-Directory</text><rect fill="#E3E3E3" height="48.5352" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="164.5833" x="1570.3125" y="35.1074"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="98.9583" x="1603.125" y="55.9357">TI-Messenger</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="150" x="1577.6042" y="72.9116">Registrierungsdienst</text><rect fill="#E3E3E3" height="48.5352" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="164.5833" x="1570.3125" y="1272.7946"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="98.9583" x="1603.125" y="1293.6228">TI-Messenger</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="150" x="1577.6042" y="1310.5988">Registrierungsdienst</text><rect fill="#FFFFFF" height="1122.2087" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="235.9375" y="132.8776"/><rect fill="#FFFFFF" height="74.235" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="549.4792" y="690.3727"/><rect fill="#FFFFFF" height="748.6735" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="754.6875" y="333.846"/><rect fill="#FFFFFF" height="134.9284" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1092.1875" y="1120.1579"/><rect fill="#FFFFFF" height="121.3867" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1283.8542" y="764.6077"/><rect fill="#FFFFFF" height="60.6934" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1496.3542" y="1194.3929"/><rect fill="#FFFFFF" height="30.3467" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1647.3958" y="273.1527"/><rect fill="#FFFFFF" height="46.11" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1647.3958" y="458.1543"/><polygon fill="#181818" points="223.4375,128.7109,233.8542,132.8776,223.4375,137.0443,227.6042,132.8776" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="31.7708" x2="229.6875" y1="132.8776" y2="132.8776"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="184.375" x="39.0625" y="111.8373">möchte seinen FHIR-Eintrag</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="46.875" x="39.0625" y="127.6006">ändern</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="246.3542" x2="290.1042" y1="178.9876" y2="178.9876"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="290.1042" x2="290.1042" y1="178.9876" y2="192.5293"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="247.3958" x2="290.1042" y1="192.5293" y2="192.5293"/><polygon fill="#181818" points="257.8125,188.3626,247.3958,192.5293,257.8125,196.696,253.6458,192.5293" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="280.2083" x="253.6458" y="157.9473">prüfe ob noch gültiges owner-accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="288.5417" x="253.6458" y="173.7106">für Schreibzugriff vom Auth-Service vorliegt</text><path d="M140.625,208.1543 L207.2917,208.1543 L207.2917,215.5843 L196.875,226.001 L140.625,226.001 L140.625,208.1543 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5625;"/><rect fill="none" height="882.6986" style="stroke:#000000;stroke-width:1.5625;" width="1615.1042" x="140.625" y="208.1543"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" font-weight="bold" lengthAdjust="spacing" textLength="19.7917" x="156.25" y="221.7656">alt</text><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="427.0833" x="222.9167" y="220.8735">[kein gültiges owner-accesstoken für Schreibzugriff vorhanden]</text><path d="M151.0417,233.2926 L217.7083,233.2926 L217.7083,240.7227 L207.2917,251.1393 L151.0417,251.1393 L151.0417,233.2926 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5625;"/><rect fill="none" height="154.6549" style="stroke:#000000;stroke-width:1.5625;" width="1594.2708" x="151.0417" y="233.2926"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" font-weight="bold" lengthAdjust="spacing" textLength="19.7917" x="166.6667" y="246.904">alt</text><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="125" x="233.3333" y="246.0119">[Org-Admin-Client]</text><polygon fill="#181818" points="1634.8958,268.986,1645.3125,273.1527,1634.8958,277.3193,1639.0625,273.1527" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="246.3542" x2="1641.1458" y1="273.1527" y2="273.1527"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="307.2917" x="253.6458" y="267.8757">POST /regservice/user/{userId}/request_token</text><polygon fill="#181818" points="257.8125,299.3327,247.3958,303.4993,257.8125,307.666,253.6458,303.4993" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="251.5625" x2="1651.5625" y1="303.4993" y2="303.4993"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="1114.5833" x="264.0625" y="298.2224">HTTP 200 OK, Result body {"access_token": "RegService-OpenID-Token",..., "reg_server_url": "https://regserver.example.com/openid/userinfo/"; "userid": "admin-userid"}</text><polygon fill="#181818" points="742.1875,329.6794,752.6042,333.846,742.1875,338.0127,746.3542,333.846" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="246.3542" x2="748.4375" y1="333.846" y2="333.846"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="488.5417" x="253.6458" y="328.569">GET /owner-authenticate... ((Auth Header mit RegService-OpenID-Token))</text><line style="stroke:#000000;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="151.0417" x2="1745.3125" y1="343.221" y2="343.221"/><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="145.8333" x="156.25" y="353.8569">[TI-Messenger-Client]</text><polygon fill="#181818" points="742.1875,375.4476,752.6042,379.6143,742.1875,383.7809,746.3542,379.6143" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="246.3542" x2="748.4375" y1="379.6143" y2="379.6143"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="163.5417" x="253.6458" y="374.3373">GET /owner-authenticate</text><path d="M696.875,402.5309 L763.5417,402.5309 L763.5417,409.9609 L753.125,420.3776 L696.875,420.3776 L696.875,402.5309 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5625;"/><rect fill="none" height="153.9551" style="stroke:#000000;stroke-width:1.5625;" width="1048.4375" x="696.875" y="402.5309"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" font-weight="bold" lengthAdjust="spacing" textLength="19.7917" x="712.5" y="416.1423">alt</text><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="184.375" x="779.1667" y="415.2501">[RegService-OpenID-Token]</text><polygon fill="#181818" points="1634.8958,453.9876,1645.3125,458.1543,1634.8958,462.321,1639.0625,458.1543" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="765.1042" x2="1641.1458" y1="458.1543" y2="458.1543"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="147.9167" x="772.3958" y="437.114">GET /openid/userinfo/?</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="280.2083" x="772.3958" y="452.8773">access_token=RegService-OpenID-Token)</text><polygon fill="#181818" points="776.5625,500.0977,766.1458,504.2643,776.5625,508.431,772.3958,504.2643" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="770.3125" x2="1651.5625" y1="504.2643" y2="504.2643"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="85.4167" x="782.8125" y="483.224">HTTP 200 OK</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="375" x="782.8125" y="498.9873">(Result Body userid des Org-Admin auf dem Reg-Server)</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="765.1042" x2="808.8542" y1="534.611" y2="534.611"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="808.8542" x2="808.8542" y1="534.611" y2="548.1527"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="766.1458" x2="808.8542" y1="548.1527" y2="548.1527"/><polygon fill="#181818" points="776.5625,543.986,766.1458,548.1527,776.5625,552.3193,772.3958,548.1527" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="80.2083" x="772.3958" y="529.334">verify userid</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="765.1042" x2="808.8542" y1="585.791" y2="585.791"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="808.8542" x2="808.8542" y1="585.791" y2="599.3327"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="766.1458" x2="808.8542" y1="599.3327" y2="599.3327"/><polygon fill="#181818" points="776.5625,595.166,766.1458,599.3327,776.5625,603.4993,772.3958,599.3327" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="298.9583" x="772.3958" y="580.514">Erzeuge PKCE Code für verifier und challenge</text><polygon fill="#181818" points="257.8125,625.5127,247.3958,629.6794,257.8125,633.846,253.6458,629.6794" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="251.5625" x2="753.6458" y1="629.6794" y2="629.6794"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="253.125" x="264.0625" y="624.4024">Redirect to IDP Authorization Endpoint</text><polygon fill="#181818" points="1276.5625,655.8594,1286.9792,660.026,1276.5625,664.1927,1280.7292,660.026" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="246.3542" x2="1282.8125" y1="660.026" y2="660.026"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="96.875" x="253.6458" y="654.749">GET /authorize</text><polygon fill="#181818" points="257.8125,686.2061,247.3958,690.3727,257.8125,694.5394,253.6458,690.3727" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="251.5625" x2="1288.0208" y1="690.3727" y2="690.3727"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="164.5833" x="264.0625" y="685.0957">Authentication challenge</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="559.8958" x2="603.6458" y1="720.7194" y2="720.7194"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="603.6458" x2="603.6458" y1="720.7194" y2="734.2611"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="560.9375" x2="603.6458" y1="734.2611" y2="734.2611"/><polygon fill="#181818" points="571.3542,730.0944,560.9375,734.2611,571.3542,738.4277,567.1875,734.2611" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="96.875" x="567.1875" y="715.4424">Authentication</text><polygon fill="#181818" points="1271.3542,760.4411,1281.7708,764.6077,1271.3542,768.7744,1275.5208,764.6077" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="554.6875" x2="1277.6042" y1="764.6077" y2="764.6077"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="230.2083" x="561.9792" y="759.3307">Authentication challenge response</text><polygon fill="#181818" points="257.8125,790.7878,247.3958,794.9544,257.8125,799.1211,253.6458,794.9544" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="251.5625" x2="1282.8125" y1="794.9544" y2="794.9544"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="316.6667" x="264.0625" y="789.6774">Authorization Response with Authorization code</text><polygon fill="#181818" points="742.1875,821.1344,752.6042,825.3011,742.1875,829.4678,746.3542,825.3011" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="246.3542" x2="748.4375" y1="825.3011" y2="825.3011"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="322.9167" x="253.6458" y="820.0241">GET /owner-authenticate with Authorization code</text><polygon fill="#181818" points="1271.3542,851.4811,1281.7708,855.6478,1271.3542,859.8145,1275.5208,855.6478" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="765.1042" x2="1277.6042" y1="855.6478" y2="855.6478"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="284.375" x="772.3958" y="850.3708">POST /tokenEndpoint {authorization code}</text><polygon fill="#181818" points="776.5625,881.8278,766.1458,885.9945,776.5625,890.1611,772.3958,885.9945" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="770.3125" x2="1288.0208" y1="885.9945" y2="885.9945"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="141.6667" x="782.8125" y="880.7175">Response {id_token}</text><path d="M696.875,901.6195 L763.5417,901.6195 L763.5417,909.0495 L753.125,919.4661 L696.875,919.4661 L696.875,901.6195 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5625;"/><rect fill="none" height="107.7067" style="stroke:#000000;stroke-width:1.5625;" width="400.5208" x="696.875" y="901.6195"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" font-weight="bold" lengthAdjust="spacing" textLength="19.7917" x="712.5" y="915.2308">alt</text><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="184.375" x="779.1667" y="914.3387">[RegService-OpenID-Token]</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="765.1042" x2="808.8542" y1="941.4795" y2="941.4795"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="808.8542" x2="808.8542" y1="941.4795" y2="955.0212"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="766.1458" x2="808.8542" y1="955.0212" y2="955.0212"/><polygon fill="#181818" points="776.5625,950.8545,766.1458,955.0212,776.5625,959.1878,772.3958,955.0212" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="312.5" x="772.3958" y="936.2025">Prüfe idtoken (professionOID for Organization?)</text><line style="stroke:#000000;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="696.875" x2="1097.3958" y1="964.3962" y2="964.3962"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="765.1042" x2="808.8542" y1="987.4512" y2="987.4512"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="808.8542" x2="808.8542" y1="987.4512" y2="1000.9928"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="766.1458" x2="808.8542" y1="1000.9928" y2="1000.9928"/><polygon fill="#181818" points="776.5625,996.8262,766.1458,1000.9928,776.5625,1005.1595,772.3958,1000.9928" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="304.1667" x="772.3958" y="982.1742">Prüfe idtoken (professionOID for Practitioner?)</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="765.1042" x2="808.8542" y1="1038.6312" y2="1038.6312"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="808.8542" x2="808.8542" y1="1038.6312" y2="1052.1729"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="766.1458" x2="808.8542" y1="1052.1729" y2="1052.1729"/><polygon fill="#181818" points="776.5625,1048.0062,766.1458,1052.1729,776.5625,1056.3395,772.3958,1052.1729" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="186.4583" x="772.3958" y="1033.3542">erzeuge owner-accesstoken</text><polygon fill="#181818" points="257.8125,1078.3529,247.3958,1082.5195,257.8125,1086.6862,253.6458,1082.5195" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="251.5625" x2="758.8542" y1="1082.5195" y2="1082.5195"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="442.7083" x="264.0625" y="1077.2425">HTTP 200 OK, Result body {"access_token"="owner-accesstoken"}</text><polygon fill="#181818" points="1079.6875,1115.9912,1090.1042,1120.1579,1079.6875,1124.3245,1083.8542,1120.1579" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="246.3542" x2="1085.9375" y1="1120.1579" y2="1120.1579"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="702.0833" x="253.6458" y="1114.8809">POST /owner/TIHealthcareService (Authorization Bearer owner-accesstoken) {providedBy.id=telematikID}</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="1102.6042" x2="1146.3542" y1="1150.5046" y2="1150.5046"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="1146.3542" x2="1146.3542" y1="1150.5046" y2="1164.0462"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="1103.6458" x2="1146.3542" y1="1164.0462" y2="1164.0462"/><polygon fill="#181818" points="1114.0625,1159.8796,1103.6458,1164.0462,1114.0625,1168.2129,1109.8958,1164.0462" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="166.6667" x="1109.8958" y="1145.2276">prüfe owner-accesstoken</text><polygon fill="#181818" points="1483.8542,1190.2262,1494.2708,1194.3929,1483.8542,1198.5596,1488.0208,1194.3929" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="1102.6042" x2="1490.1042" y1="1194.3929" y2="1194.3929"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="373.9583" x="1109.8958" y="1189.1159">POST /TIHealthcareService {providedBy.id=telematikID}</text><polygon fill="#181818" points="1114.0625,1220.5729,1103.6458,1224.7396,1114.0625,1228.9063,1109.8958,1224.7396" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="1107.8125" x2="1495.3125" y1="1224.7396" y2="1224.7396"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="209.375" x="1120.3125" y="1219.4626">HTTP 200 OK (Result Body json)</text><polygon fill="#181818" points="252.6042,1250.9196,242.1875,1255.0863,252.6042,1259.2529,248.4375,1255.0863" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="246.3542" x2="1096.3542" y1="1255.0863" y2="1255.0863"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="209.375" x="258.8542" y="1249.8093">HTTP 200 OK (Result Body json)</text><!--MD5=[eb7727617339428da7f66ebf28d2c081]
@startuml
skinparam dpi 100
skinparam WrapWidth 200
skinparam monochrome true

'title "FHIR-Directory, Sequenzdiagram Änderung von eigenen TIOrganization- oder TIPractitioner-Einträgen'
actor o as "Owner"
participant cl as "Org-Admin-Client\noder\nTI-Messenger-Client"
participant aa as "Authenticator App\ndes IDP"
participant au as "Auth-Service"
participant fp as "FHIR-Proxy"
participant idp as "Identity Provider"
participant fd as "FHIR-Directory"
participant rd as "TI-Messenger\nRegistrierungsdienst"
o -> cl: möchte seinen FHIR-Eintrag\nändern
activate cl
cl -> cl: prüfe ob noch gültiges owner-accesstoken\nfür Schreibzugriff vom Auth-Service vorliegt
alt kein gültiges owner-accesstoken für Schreibzugriff vorhanden
alt Org-Admin-Client
cl -> rd: POST /regservice/user/{userId}/request_token
activate rd
rd - -> cl: HTTP 200 OK, Result body {"access_token": "RegService-OpenID-Token",..., "reg_server_url": "https://regserver.example.com/openid/userinfo/"; "userid": "admin-userid"}
deactivate rd
cl -> au: GET /owner-authenticate... ((Auth Header mit RegService-OpenID-Token))
activate au
else TI-Messenger-Client
cl -> au: GET /owner-authenticate
end
alt RegService-OpenID-Token
au -> rd: GET /openid/userinfo/?\naccess_token=RegService-OpenID-Token)
activate rd
rd - -> au: HTTP 200 OK\n(Result Body userid des Org-Admin auf dem Reg-Server)
deactivate rd
au -> au: verify userid
end
au -> au: Erzeuge PKCE Code für verifier und challenge
au - -> cl: Redirect to IDP Authorization Endpoint
cl -> idp: GET /authorize
idp - -> cl: Authentication challenge
activate aa
aa -> aa: Authentication
aa - -> idp: Authentication challenge response
deactivate aa
activate idp
idp - -> cl: Authorization Response with Authorization code
cl -> au: GET /owner-authenticate with Authorization code
au -> idp: POST /tokenEndpoint {authorization code}
idp - -> au: Response {id_token}

deactivate idp
alt RegService-OpenID-Token
au -> au: Prüfe idtoken (professionOID for Organization?)
else
au -> au: Prüfe idtoken (professionOID for Practitioner?)
end
au -> au: erzeuge owner-accesstoken
au - -> cl: HTTP 200 OK, Result body {"access_token"="owner-accesstoken"}
deactivate au
end
cl -> fp: POST /owner/TIHealthcareService (Authorization Bearer owner-accesstoken) {providedBy.id=telematikID}
activate fp
fp -> fp: prüfe owner-accesstoken
fp -> fd: POST /TIHealthcareService {providedBy.id=telematikID}
activate fd
fd - -> fp: HTTP 200 OK (Result Body json)
fp - -> cl: HTTP 200 OK (Result Body json)
deactivate fd
deactivate fp
deactivate cl
@enduml

@startuml
skinparam dpi 100
skinparam WrapWidth 200
skinparam monochrome true

actor o as "Owner"
participant cl as "Org-Admin-Client\noder\nTI-Messenger-Client"
participant aa as "Authenticator App\ndes IDP"
participant au as "Auth-Service"
participant fp as "FHIR-Proxy"
participant idp as "Identity Provider"
participant fd as "FHIR-Directory"
participant rd as "TI-Messenger\nRegistrierungsdienst"
o -> cl: möchte seinen FHIR-Eintrag\nändern
activate cl
cl -> cl: prüfe ob noch gültiges owner-accesstoken\nfür Schreibzugriff vom Auth-Service vorliegt
alt kein gültiges owner-accesstoken für Schreibzugriff vorhanden
alt Org-Admin-Client
cl -> rd: POST /regservice/user/{userId}/request_token
activate rd
rd - -> cl: HTTP 200 OK, Result body {"access_token": "RegService-OpenID-Token",..., "reg_server_url": "https://regserver.example.com/openid/userinfo/"; "userid": "admin-userid"}
deactivate rd
cl -> au: GET /owner-authenticate... ((Auth Header mit RegService-OpenID-Token))
activate au
else TI-Messenger-Client
cl -> au: GET /owner-authenticate
end
alt RegService-OpenID-Token
au -> rd: GET /openid/userinfo/?\naccess_token=RegService-OpenID-Token)
activate rd
rd - -> au: HTTP 200 OK\n(Result Body userid des Org-Admin auf dem Reg-Server)
deactivate rd
au -> au: verify userid
end
au -> au: Erzeuge PKCE Code für verifier und challenge
au - -> cl: Redirect to IDP Authorization Endpoint
cl -> idp: GET /authorize
idp - -> cl: Authentication challenge
activate aa
aa -> aa: Authentication
aa - -> idp: Authentication challenge response
deactivate aa
activate idp
idp - -> cl: Authorization Response with Authorization code
cl -> au: GET /owner-authenticate with Authorization code
au -> idp: POST /tokenEndpoint {authorization code}
idp - -> au: Response {id_token}

deactivate idp
alt RegService-OpenID-Token
au -> au: Prüfe idtoken (professionOID for Organization?)
else
au -> au: Prüfe idtoken (professionOID for Practitioner?)
end
au -> au: erzeuge owner-accesstoken
au - -> cl: HTTP 200 OK, Result body {"access_token"="owner-accesstoken"}
deactivate au
end
cl -> fp: POST /owner/TIHealthcareService (Authorization Bearer owner-accesstoken) {providedBy.id=telematikID}
activate fp
fp -> fp: prüfe owner-accesstoken
fp -> fd: POST /TIHealthcareService {providedBy.id=telematikID}
activate fd
fd - -> fp: HTTP 200 OK (Result Body json)
fp - -> cl: HTTP 200 OK (Result Body json)
deactivate fd
deactivate fp
deactivate cl
@enduml

PlantUML version 1.2022.5(Sat Apr 30 10:55:52 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>